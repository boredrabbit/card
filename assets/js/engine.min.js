!function(t){function e(e){for(var r,n,s=e[0],c=e[1],u=e[2],h=0,f=[];h<s.length;h++)n=s[h],Object.prototype.hasOwnProperty.call(i,n)&&i[n]&&f.push(i[n][0]),i[n]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);for(l&&l(e);f.length;)f.shift()();return a.push.apply(a,u||[]),o()}function o(){for(var t,e=0;e<a.length;e++){for(var o=a[e],r=!0,s=1;s<o.length;s++){var c=o[s];0!==i[c]&&(r=!1)}r&&(a.splice(e--,1),t=n(n.s=o[0]))}return t}var r={},i={1:0},a=[];function n(e){if(r[e])return r[e].exports;var o=r[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=r,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="";var s=window.fasfasfasfd=window.fasfasfasfd||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var l=c;a.push([156,0]),o()}({156:function(t,e,o){t.exports=o(190)},190:function(t,e,o){"use strict";o.r(e),o(58);var r=o(0);o(161),o(84),o(124),o(162),o(66),o(17),o(164),o(167);var i=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)};function a(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}i.checkPJAX=!1,i.isSP=!1,i.isTAB=!1,i.isPC=!1,i.isMobile=!1,i.isIE=!1,i.isMS=!1,i.isFF=!1,i.isChrome=!1,i.isSafari=!1,i.isSafari11=!1,i.isRetina=!1,i.isOSX=!1,i.pixelRatio=1,i.getUserCondition=function(){var t=navigator.userAgent.toLowerCase(),e="gecko",o="webkit",r="safari",i="opera",a=function(e){return t.indexOf(e)>-1};return[!/opera|webtv/i.test(t)&&/msie\s(\d+)/.test(t)?"ie ie"+RegExp.$1:/trident\/(\d+)/.test(t)?"ie ie"+(parseInt(RegExp.$1)+4):/firefox\/(\d+)/.test(t)?e+" ff ff"+RegExp.$1:a("gecko/")?e:a("opera")?i+(/version\/(\d+)/.test(t)?" "+i+RegExp.$1:/opera(\s|\/)(\d+)/.test(t)?" "+i+RegExp.$2:""):a("chrome")?o+" chrome":a("applewebkit/")?o+" "+r+(/version\/(\d+)/.test(t)?" "+r+RegExp.$1+(parseInt(RegExp.$1)>=11?" safari11over":""):""):a("mozilla/")?e:"",a("edge")?"edge":"",a("crios")?"chrome":"",a("mac")?"mac"+(/mac os x (\d+)_(\d+)/.test(t)?" osx osx"+RegExp.$1+" osx"+RegExp.$1+"_"+RegExp.$2:""):a("darwin")?"mac":a("j2me")?"mobile":a("webtv")?"webtv":a("win")?a("nt 4")?"win winnt":a("nt 5")?"win xp":a("nt 6.1")?"win win7":a("nt 6.2")?"win win8":a("nt 6.3")?"win win8 win8.1":a("nt 6.0")?"win vista":"win":a("freebsd")?"freebsd":a("x11")||a("linux")?"linux":"",a("iemobile")?" sp iemobile":a("iphone")?" iphone sp"+(/os (\d+)_(\d+)/.test(t)?" ios ios"+RegExp.$1+" ios"+RegExp.$1+"_"+RegExp.$2:""):a("ipod")?" ipod sp"+(/os (\d+)_(\d+)/.test(t)?" ios ios"+RegExp.$1+" ios"+RegExp.$1+"_"+RegExp.$2:""):a("ipad")||a("macintosh")&&"ontouchend"in document?" ipad tablet"+(/os (\d+)_(\d+)/.test(t)?" ios ios"+RegExp.$1+" ios"+RegExp.$1+"_"+RegExp.$2:""):a("android")?a("mobile")?" android sp":" android tablet":a("dream")?" android sp":a("cupcake")||a("blackberry")||a("webos")||a("incognito")||a("webmate")?" sp":"","js"]},i.setup=function(){var t=i.getUserCondition().join(" "),e=t.split(" ");e.includes("sp")||e.includes("tablet")||(e.push("pc"),t+=" pc"),i.conditions=e,document.documentElement.className=t,i.extractConditions(e)},i.extractConditions=function(t){i.isSP=t.includes("sp"),i.isTAB=t.includes("tablet"),i.isMobile=!(i.isPC=!(i.isSP||i.isTAB)),i.isIE=t.includes("ie"),i.isMS=t.includes("edge")||i.isIE,i.isFF=t.includes("ff"),i.isChrome=t.includes("chrome"),i.isSafari=t.includes("safari"),i.isSafari11=t.includes("safari11")||t.includes("safari12")||t.includes("safari13")||t.includes("safari14")||t.includes("safari15")||t.includes("safari16")||t.includes("safari17")||t.includes("safari18")||t.includes("safari19")||t.includes("safari20")||t.includes("safari21")||t.includes("safari22")||t.includes("safari23")||t.includes("safari24")||t.includes("safari25")||t.includes("safari26")||t.includes("safari27")||t.includes("safari28")||t.includes("safari29")||t.includes("safari30"),i.isOSX=t.includes("osx"),i.checkPJAX="function"==typeof history.pushState&&-1===location.protocol.indexOf("https")&&!0,i.pixelRatio=1|window.devicePixelRatio,i.isRetina=i.pixelRatio>1};var n=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.node=e}var e,o,r;return e=t,r=[{key:"init",value:function(){i.isSP?(this.basew=384,this.baseh=304):(this.basew=768,this.baseh=512),this.contentMargin=3*this.baseh}}],(o=[{key:"update",value:function(){}},{key:"resize",value:function(t,e){}},{key:"setYOffset",value:function(t){}},{key:"setNodeOffset",value:function(t){}},{key:"setSquareColor",value:function(t,e){return!1}},{key:"checkMovablePoint",value:function(t,e){return t}},{key:"toggleMode",value:function(t){this.node.find(".bghidable").toggleClass("hidden")}}])&&a(e.prototype,o),r&&a(e,r),t}();function s(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}o(8),o(6),o(34),o(108),o(35),o(36),o(37),o(38),o(39),o(40),o(41),o(42),o(43),o(44),o(45),o(46),o(47),o(48),o(49),o(50),o(51),o(52),o(53),o(54),o(55),o(56),o(57);var c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e}var e,o,r;return e=t,r=[{key:"generate",value:function(t,e,o){var r=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,o),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),r}}],(o=[{key:"generate",value:function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return o=-1==o?this.gl.STATIC_DRAW:o,this.buffer=t.generate(this.gl,e,o),this.dataLength=e.length,this.buffer}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.buffer)}}])&&s(e.prototype,o),r&&s(e,r),t}();function u(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e}var e,o,r;return e=t,r=[{key:"generate",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.CLAMP_TO_EDGE,r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);var i=e.width,a=e.height;return i&i-1||a&a-1||t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null),r}}],(o=[{key:"generate",value:function(e,o){return this.src=e,this.texture=t.generate(this.gl,e,o),this}},{key:"update",value:function(){this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.src)}}])&&u(e.prototype,o),r&&u(e,r),t}();function h(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e}var e,o,r;return e=t,r=[{key:"generate",value:function(t,e,o){var r=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,e,o),t.bindBuffer(t.ARRAY_BUFFER,null),r}}],(o=[{key:"generate",value:function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return o=-1==o?this.gl.STATIC_DRAW:o,this.buffer=t.generate(this.gl,e,o),this.dataLength=e.length,this.buffer}},{key:"update",value:function(t){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,t),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.dataLength=t.length,this.buffer}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.buffer)}}])&&h(e.prototype,o),r&&h(e,r),t}();function d(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}o(27),o(88),o(28),o(18),o(29),o(19);var v=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o;return e=t,o=[{key:"init",value:function(t){var e=this;this.vertices=[],this.indices=[],this.vertices.push(-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5),this.indices.push(0,1,2,2,1,3,5,4,7,7,4,6,3,1,7,7,1,5,2,3,6,6,3,7,0,2,4,4,2,6,1,0,5,5,0,4),this.ibo=new c(t),this.vbo=new f(t),this.ibo.generate(new Int16Array(this.indices)),this.vbo.generate(new Float32Array(this.vertices)),this.indexLength=this.indices.length,this.matrix=r.a.create(),this.colors=[],ae.colorBases.forEach(function(t){e.colors.push(parseInt(t.substr(0,2),16)/255),e.colors.push(parseInt(t.substr(2,2),16)/255),e.colors.push(parseInt(t.substr(4,2),16)/255)})}}],null&&d(e.prototype,null),o&&d(e,o),t}();function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function m(t,e,o){return e&&g(t.prototype,e),o&&g(t,o),t}o(20),o(21),o(22),o(90),o(111),o(76),o(23),o(24);var b=function(){function t(e,o,r,i){p(this,t),this.calc=new y,this.calc.set([0,0],[e,o],[r,i],[1,1])}return m(t,[{key:"get",value:function(t){return this.calc.getValueY(t)}},{key:"getEqual",value:function(t){for(var e=0,o=1,r=.5*(o+e),i=this.calc.getValueX(r);Math.abs(t-i)>1e-4;)t>i?e=r:o=r,r=.5*(o+e),i=this.calc.getValueX(r);return this.calc.getValueY(r)}}]),t}(),y=function(){function t(){p(this,t),this.cpoints=[[],[],[],[]],this.polinom=[[],[],[],[]]}return m(t,[{key:"set",value:function(t,e,o,r){this.setPoint(0,t),this.setPoint(1,e),this.setPoint(2,o),this.setPoint(3,r),this.generate()}},{key:"setPoint",value:function(t,e){this.cpoints[t][0]=e[0],this.cpoints[t][1]=e[1]}},{key:"generate",value:function(){for(var t=0;t<2;t++){var e=this.cpoints[0][t],o=this.cpoints[1][t],r=this.cpoints[2][t],i=this.cpoints[3][t];this.polinom[0][t]=e+3*(o-r)+i,this.polinom[1][t]=3*(e-2*o+r),this.polinom[2][t]=3*(-e+o),this.polinom[3][t]=e}}},{key:"getValueX",value:function(t){return this.getValue(0,t)}},{key:"getValueY",value:function(t){return this.getValue(1,t)}},{key:"getValue",value:function(t,e){return((this.polinom[0][t]*e+this.polinom[1][t])*e+this.polinom[2][t])*e+this.polinom[3][t]}}]),t}();function w(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var x=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o;return e=t,o=[{key:"init",value:function(){i.isSP?(this.sw=120*P.dotscale,this.sh=80*P.dotscale):(this.sw=200*P.dotscale,this.sh=100*P.dotscale);var t=n.basew,e=n.baseh;this.wOffset=Math.floor((this.sw-t)/(2*P.dotscale)),this.hOffset=2*Math.floor(.5*(2*this.sh-e)/(2*P.dotscale)),this.leftOffset=Math.floor(10*this.wOffset/8),this.areaw=t/P.dotscale,this.areah=e/P.dotscale,this.W=2*this.wOffset+this.areaw,this.H=2*this.hOffset+this.areah}}],null&&w(e.prototype,null),o&&w(e,o),t}();function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function M(t,e){return(M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function O(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var o,r=E(t);if(e){var i=E(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return function(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,o)}}function E(t){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var P=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}(c,n);var e,o,a,s=O(c);function c(){var t;!function(t,e){if(!(t instanceof c))throw new TypeError("Cannot call a class as a function")}(this),(t=s.call(this,$())).cubeScale=c.dotscale,t.initialPositions=[],t.wOffset=x.wOffset,t.hOffset=x.hOffset,t.leftOffset=x.leftOffset,t.areaw=x.areaw,t.areah=x.areah,t.w=x.W,t.h=x.H,t.fieldOccupation=[];for(var e=0;e<t.h;e++)t.fieldOccupation.push(new Array(t.w).fill(0));t.cubeOccupation=new Array(c.cubeCountMax).fill(1),t.dirDurationToStables=[],t.dirCandidates=[];for(var o=c.cubeCountMax;o--;){var r=c.changeDirs(0);t.dirDurationToStables.push(r.duration),t.dirCandidates.push(r.dirs)}return t}return e=c,a=[{key:"init",value:function(){var t;for(t=this.cubeCountMax+11;t-- >0;)this.waitRollingCandidates.push(10+Math.floor(90*Math.random()));i.isSP&&(c.dotscale=128)}},{key:"changeDirs",value:function(t){return t>0?{dirs:this.dirsDown,duration:10+Math.floor(30*Math.random())}:t<0?{dirs:this.dirsUp,duration:10+Math.floor(30*Math.random())}:{dirs:this.dirsStable,duration:0}}}],(o=[{key:"init",value:function(t){this.gl=t,c.changeDirs(0),this.setupModel()}},{key:"initBefore",value:function(t,e){var o=c.cubeCountMax;this.initialPositions=this.initialPositions.concat(t);var r=o-this.initialPositions.length,i=[];if(r>0)for(var a=this.leftOffset,n=this.hOffset,s=this.areaw,u=this.areah,l=this.w,h=this.h,f=0;f<r;f++){for(var d=Math.floor(l*Math.random()),v=Math.floor(h*Math.random());a<=d&&d<a+s&&n<=v&&v<n+u;)d=Math.floor(l*Math.random()),v=Math.floor(h*Math.random());i.push({index:-1,skip:!0,to:[d-a,v-n,0],offsets:{l:0,r:0,t:0,b:0,w:0,h:0}})}return i}},{key:"setupModel",value:function(){this.colors=[],this.matrices=[],this.invmatrices=[],this.matricesOriginal=[],this.waitList=[],this.rolling=[],this.waitRolling=new Array(c.cubeCountMax).fill(0),this.dirs=[],this.times=[],this.cubeCount=c.cubeCountMax,this.matricesBase=new Float32Array(16*this.cubeCount),this.invmatricesBase=new Float32Array(16*this.cubeCount);for(var t=0;t<this.cubeCount;++t){var e=16*t*4;this.matrices.push(new Float32Array(this.matricesBase.buffer,e,16)),this.invmatrices.push(new Float32Array(this.invmatricesBase.buffer,e,16))}for(var o=this.leftOffset,i=this.hOffset,a=this.cubeScale,n=0;n<this.cubeCount;n++){r.a.fromScaling(this.matrices[n],[a,a,a]),r.a.translate(this.matrices[n],this.matrices[n],[this.initialPositions[n].to[0]+.5,this.initialPositions[n].to[1]+.5,.5]),r.a.invert(this.invmatrices[n],this.matrices[n]);var s=n%(v.colors.length/3);this.colors.push(v.colors[3*s+0],v.colors[3*s+1],v.colors[3*s+2]),++this.fieldOccupation[this.initialPositions[n].to[1]+i][this.initialPositions[n].to[0]+o]}for(var u=this.matricesBase.buffer.slice(0),l=0;l<this.cubeCount;++l){var h=16*l*4;this.matricesOriginal.push(new Float32Array(u,h,16))}this.vboColors=new f(this.gl),this.vboMatrices=new f(this.gl),this.vboInvMatrices=new f(this.gl),this.vboColors.generate(new Float32Array(this.colors)),this.vboMatrices.generate(this.matricesBase,this.gl.DYNAMIC_DRAW),this.vboInvMatrices.generate(this.invmatricesBase),this.scrollOffsetBase=Math.floor(ae.camera.getOffset()[1]/a),this.scrollOffset=0,this.cubeCount=0}},{key:"changeDirs",value:function(t){for(var e=this.cubeCount;e--;){var o=c.changeDirs(t);this.dirDurationToStables[e]=o.duration,this.dirCandidates[e]=o.dirs}}},{key:"update",value:function(){this.cubeCount<c.cubeCountMax&&++this.cubeCount;var t,e,o,i,a=n.basew,s=this.cubeScale,u=r.a.create();t=this.waitList.length;var l=this.wOffset,h=this.leftOffset,f=this.hOffset,d=this.w,v=this.h,p=Math.floor(ae.camera.getOffset()[1]/s-this.scrollOffsetBase),g=p-this.scrollOffset;if(this.scrollOffset=p,g>0){for(var m=this.fieldOccupation.splice(0,(v+g%v)%v),b=0;b<m.length;b++)m[b].fill(0);this.fieldOccupation=this.fieldOccupation.concat(m)}else if(g<0){for(var y=this.fieldOccupation.splice((v+g%v)%v),w=0;w<y.length;w++)y[w].fill(0);this.fieldOccupation=y.concat(this.fieldOccupation)}for(;t--;){var x=this.waitList[t],S=this.matricesOriginal[this.waitList[t].index];o=S[12]/s-.5;var C=(((i=S[13]/s-.5)-this.scrollOffset)%v+f+v)%v,M=((x.to[1]-this.scrollOffset)%v+f+v)%v,O=o+h,E=x.to[0]+h;if(x.skip){var P=this.matrices[this.waitList[t].index];--this.fieldOccupation[C][O],r.a.fromScaling(S,[s,s,s]),r.a.translate(S,S,[x.to[0]+.5,x.to[1]+.5,.5]),r.a.copy(P,S),this.fieldOccupation[M][E]=1}else{var k=this.fieldOccupation[C][O],T=this.fieldOccupation[M][E];k==this.cubeOccupation[this.waitList[t].index]&&T==Math.floor(T)&&(this.rolling[this.waitList[t].index]=!0,this.fieldOccupation[C][O]-=.5,this.fieldOccupation[M][E]+=.5)}}for(this.waitList=[],t=this.cubeCount;t--;){var R=this.matricesOriginal[t],A=(i=R[13]/s-.5)-this.scrollOffset;if(A<-f){for(var q=Math.floor(d*Math.random())-h,I=i+v;this.fieldOccupation[I%v][q]>0;)q=Math.floor(d*Math.random())-h;this.waitList.push({index:t,skip:!0,to:[q,I,0],offsets:{l:0,r:0,t:0,b:0,w:0,h:0}}),this.cubeOccupation[t]=1,this.dirCandidates[t]=c.changeDirs(0).dirs,this.rolling[t]=!1}else if(A>v-f){for(var F=Math.floor(d*Math.random())-h,B=i-v;this.fieldOccupation[(B%v+v)%v][F]>0;)F=Math.floor(d*Math.random())-h;this.waitList.push({index:t,skip:!0,to:[F,B,0],offsets:{l:0,r:0,t:0,b:0,w:0,h:0}}),this.cubeOccupation[t]=1,this.dirCandidates[t]=c.changeDirs(0).dirs,this.rolling[t]=!1}else{if(!this.rolling[t]&&--this.waitRolling[t]<0&&Math.random()<.1){var _=--this.dirDurationToStables[t];_>0?this.waitRolling[t]=0:0==_?this.dirCandidates[t]=c.changeDirs(0).dirs:this.waitRolling[t]=c.waitRollingCandidates[++c.waitRollingCandidatesIndex%c.waitRollingCandidates.length],o=R[12]/s-.5;var L=((i-this.scrollOffset)%v+f+v)%v,D=o+h,G=this.fieldOccupation[L][D];if(G==this.cubeOccupation[t]){for(var j=(e=this.dirCandidates[t])[Math.floor(Math.random()*e.length)];-h>o+j[0]||o+j[0]>d-h+l-1;)j=e[Math.floor(Math.random()*e.length)];var N=0,z=j[0],U=j[1];if(!(0<L+U&&L+U<v&&0<D+z&&D+z<d))continue;var Y=this.fieldOccupation[L+U][D+z];if(Y-G==0)N=G+1;else if(Y-G==-1)N=G;else{if(Y-G!=-2)continue;N=G-1}o+=z,i+=U,this.waitList.push({index:t,skip:!1,to:[o,i,N],offsets:{l:0,r:0,t:0,b:0,w:0,h:0}}),this.dirs[t]=[z,U,N-G],this.times[t]=0}}if(this.rolling[t]){var V=this.dirs[t],W=V[0],X=V[1],H=V[2],Z=this.times[t]+=.1*(0==H?1:H>0?.5:.75),J=this.matrices[t],Q=this.matricesOriginal[t];if(1-Z<.04){this.times[t]=0,this.rolling[t]=!1,o=Q[12]/s-.5;var K=(((i=Q[13]/s-.5)-this.scrollOffset)%v+f+v)%v,tt=o+h;if(!this.fieldOccupation[K+X]){this.rolling[t]=!1;continue}this.fieldOccupation[K][tt]-=.5,this.fieldOccupation[K+X][tt+W]+=.5,this.cubeOccupation[t]+=H,r.a.translate(Q,Q,[W,X,H]),r.a.copy(J,Q),o=Q[12]/s-.5,i=Q[13]/s-.5,0<=o&&o<a&&J[14]<s&&$(this).trigger("colorize",{position:[o,i],color:[this.colors[3*t],this.colors[3*t+1],this.colors[3*t+2]]})}else 0!=W?(r.a.fromTranslation(u,[W/2,0,-(1-2*Math.floor((H+1)/2))/2]),r.a.rotateY(u,u,c.cb.get(Z)*W*Math.PI*(1+Math.abs(H))/2),r.a.translate(u,u,[-W/2,0,(1-2*Math.floor((H+1)/2))/2])):(r.a.fromTranslation(u,[0,X/2,-(1-2*Math.floor((H+1)/2))/2]),r.a.rotateX(u,u,c.cb.get(Z)*-X*Math.PI*(1+Math.abs(H))/2),r.a.translate(u,u,[0,-X/2,(1-2*Math.floor((H+1)/2))/2])),r.a.multiply(J,Q,u)}this.vboMatrices.update(this.matricesBase)}}}},{key:"resize",value:function(t,e){}}])&&C(e.prototype,o),a&&C(e,a),c}();function k(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}P.dotscale=128,P.cubeCountMax=100,P.dirsDown=[[1,0],[-1,0],[0,-1],[0,1],[1,0],[-1,0],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1]],P.dirsUp=[[1,0],[-1,0],[0,-1],[0,1],[1,0],[-1,0],[0,-1],[0,-1],[0,-1],[0,-1],[0,-1],[0,-1],[0,-1],[0,-1],[0,-1],[0,-1],[0,-1],[0,-1],[0,-1],[0,-1],[0,-1]],P.dirsStable=[[1,0],[-1,0],[0,-1],[0,1]],P.cb=new b(0,0,1,.4),P.waitRollingCandidates=[],P.waitRollingCandidatesIndex=0;var T,R=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o;return e=t,(o=[{key:"load",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(function(r,i){var a=document.createElement("img");a.addEventListener("load",function(){r(a)}),a.addEventListener("error",function(){i()}),e?(a.setAttribute("src",t),a.setAttribute("srcset",o),a.setAttribute("sizes",e)):a.setAttribute("src",t)})}}])&&k(e.prototype,o),t}(),A=(o(112),function(t){for(var e,o="",r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";t--;)e=Math.floor(r.length*Math.random()),o+=r.substring(e,e+1);return o}),q=0,I=0,F=0,B=!1,_=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$(document),o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.6;if(F=Math.floor(t),!B){B=!0;var i=e.scrollTop()||0;if(Math.abs(F-i)<Math.abs(r))return B=!1,e.scrollTop(F),void e.trigger("slided");var a=function t(){I=q=0,e.trigger("slideCanceled"),B=!1,e.off("mousedown.scroller",t),e.off("mousewheel.scroller wheel.scroller",t),e.off("keypress.scroller",t),e.off("touchstart.scroller",t),$(window).off("resize.scroller",t)};o&&(e.on("mousedown.scroller",a),e.on("mousewheel.scroller wheel.scroller",a),e.on("keypress.scroller",a),e.on("touchstart.scroller",a),$(window).on("resize.scroller",a)),F>i?(T=function(){if(B){if(q<.2*(F-i)?q+=I+=r:(I=0,q=.2*(F-i)),i+=q,Math.abs(F-i)<.5)return q=0,i=F,B=!1,e.off("mousedown.scroller",a),e.off("mousewheel.scroller wheel.scroller",a),e.off("keypress.scroller",a),e.off("touchstart.scroller",a),$(window).off("resize.scroller",a),e.scrollTop(i),void e.trigger("slided");e.scrollTop(i),requestAnimationFrame(T)}})(0):F<i?(T=function(){if(B){if(q>.2*(F-i)?q+=I-=r:(I=0,q=.2*(F-i)),i+=q,Math.abs(F-i)<.5)return q=0,i=F,B=!1,e.off("mousedown.scroller",a),e.off("mousewheel.scroller wheel.scroller",a),e.off("keypress.scroller",a),e.off("touchstart.scroller",a),$(window).off("resize.scroller",a),e.scrollTop(i),void e.trigger("slided");e.scrollTop(i),requestAnimationFrame(T)}})(0):(q=0,I=0,i=F,B=!1,e.off("mousedown.scroller",a),e.off("mousewheel.scroller wheel.scroller",a),e.off("keypress.scroller",a),e.off("touchstart.scroller",a),$(window).off("resize.scroller",a),e.trigger("slided"))}},L=function(t,e){var o=!1,r=function(){o=!1,t.on("touchmove.touch",function(){t.off("touchmove.touch"),o=!0})};t.off(".touch"),t.on("touchstart.touch",function(t){r()}).on("touchend.touch",function(r){!function(r){t.off("touchmove.touch"),o||e(r)}(r)}).on("click.touch",function(t){!function(t){i.isMobile||e(t)}(t)})};function D(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function G(t){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function N(t,e){return(N=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function z(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var o,r=U(t);if(e){var i=U(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return function(t,e){return!e||"object"!==G(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,o)}}function U(t){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&N(t,e)}(i,t);var e,o,r=z(i);function i(){return function(t,e){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this),r.call(this)}return e=i,(o=[{key:"start",value:function(t){var e=this;return this.timer=setTimeout(function(){e.resolve()},t),this.promise()}},{key:"cancel",value:function(){clearTimeout(this.timer),this.reject()}}])&&j(e.prototype,o),i}(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o;return e=t,(o=[{key:"promise",value:function(){var t=this;return this._p||(this._p=new Promise(function(e,o){t._resolve=e,t._reject=o})),this._p}},{key:"resolve",value:function(t){this._p||this.promise(),this._resolve(t)}},{key:"reject",value:function(t){this._p||this.promise(),this._reject(t)}}])&&D(e.prototype,o),t}());function V(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var W=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.scale=e,this.baseMatrix=r.a.create(),this.offsetMatrix=r.a.create(),this.matrix=r.a.create(),this.matrices=[],this.left=1e5,this.right=-1e5,this.top=1e5,this.bottom=-1e5,this.width=0,this.height=0}var e,o;return e=t,(o=[{key:"getBaseMatrix",value:function(){return this.baseMatrix}},{key:"setBaseMatrix",value:function(t){this.baseMatrix=t,r.a.multiply(this.matrix,this.offsetMatrix,t)}},{key:"getOffsetMatrix",value:function(){return this.offsetMatrix}},{key:"setOffsetMatrix",value:function(t){this.offsetMatrix=t,r.a.multiply(this.matrix,t,this.baseMatrix)}},{key:"mergeOffsetToBase",value:function(){r.a.multiply(this.baseMatrix,this.offsetMatrix,this.baseMatrix),r.a.identity(this.offsetMatrix),r.a.multiply(this.matrix,this.offsetMatrix,this.baseMatrix)}},{key:"addChild",value:function(t){this.matrices.push(t);var e=t[12],o=t[13],r=Math.abs(t[0])/this.scale,i=Math.abs(t[5])/this.scale;this.left>e-r*this.scale/2&&(this.left=e-r*this.scale/2),this.right<e+r*this.scale/2&&(this.right=e+r*this.scale/2),this.top>o-i*this.scale/2&&(this.top=o-i*this.scale/2),this.bottom<o+i*this.scale/2&&(this.bottom=o+i*this.scale/2),this.width=this.right-this.left,this.height=this.bottom-this.top}},{key:"removeChild",value:function(t){for(var e=this.matrices.length;e--;)if(this.matrices[e]==t){this.matrices.splice(e,1);break}}}])&&V(e.prototype,o),t}();function X(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}W.matrix=r.a.create(),o(186),o(149);var H=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o,i;return e=t,i=[{key:"getData",value:function(t){return this.datalist[t]}}],(o=[{key:"load",value:function(e){var o=this;return new Promise(function(r,i){if(o.data)r(o);else{if(o.nouse=!!e.nouse,!o.nouse){o.loopFrame=-1,o.name=e.name,o.data=e.data,o.norotate=!!e.norotate,o.nofreeuse=!!e.nofreeuse,o.nomulti=!!e.nomulti,o.totalFrames=o.data.length,o.zOffset=e.z?e.z:0,o.group=e.group?e.group:[];var a=o.totalFrames;for(o.size=e.size?e.size/16*P.dotscale*(o.nofreeuse?1:t.scaleFactor):P.dotscale;a--;)if(1==o.data[a].l){o.loopFrame=a;break}o.setup(),o.hasData=!0}r(o)}})}},{key:"setup",value:function(){var e=this;this.using=0;var o=[];this.durations=[],this.animations=[],this.frameOffsets=[],this.matricesCube=[],this.colors=[],this.dir=[0,0,0],this.left=1e5,this.right=-1e5,this.top=1e5,this.bottom=-1e5,this.width=0,this.height=0,this.staysGround=!1,this.startsEmpty=!1,0==this.data[0].p.length&&(this.startsEmpty=!0),-1==this.loopFrame&&0==this.data[this.data.length-1].p.length&&(this.endsEmpty=!0),this.maxCubes=0;var i=0;this.data.forEach(function(t){e.frameOffsets.push(i);var r=t.p.length/3;i+=r,e.maxCubes<r&&(e.maxCubes=r);var a=t.o||[0,0,0];e.dir[0]+=a[0],e.dir[1]+=a[1],e.dir[2]+=a[2],e.animations.push(a),e.durations.push(t.d),o=o.concat(t.c)}),this.colors=o.map(function(t){return t/255}),this.matricesCubeBase=new Float32Array(16*i);for(var a=0;a<i;++a){var n=16*a*4;this.matricesCube.push(new Float32Array(this.matricesCubeBase.buffer,n,16))}var s=this.size;this.frames=[];for(var c=0,u=-1e3,l=1e3,h=0;h<this.totalFrames;h++){var f=[];this.frames.push(f);for(var d=0;d<this.data[h].p.length;d+=3){var v=this.matricesCube[d/3+c];r.a.fromScaling(v,[s,s,s]);var p=this.data[h].p[d+0],g=this.data[h].p[d+1],m=this.data[h].p[d+2]+this.zOffset;r.a.translate(v,v,[p+.5,g+.5,m+.5]),f.push(v);var b=p,y=g;this.left>b&&(this.left=b),this.right<b&&(this.right=b),this.top>y&&(this.top=y),this.bottom<y&&(this.bottom=y),m>u&&(u=m),m<l&&(l=m)}c+=this.data[h].p.length/3}this.width=this.right-this.left,this.height=this.bottom-this.top,l<=0&&u>=0&&(this.staysGround=!0),u<0&&(this.staysUnderground=!0),t.datalist[this.name]=this}}])&&X(e.prototype,o),i&&X(e,i),t}();function Z(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}H.scaleFactor=.5,H.datalist={},H.numStaticData=[0,0,0,0,0],H.numDynamicData=[0,0,0,0,0];var J=function(){function t(e,o){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.file=o,this.playsFile=r,this.init(e,r)}var e,o;return e=t,(o=[{key:"init",value:function(t,e){t&&!e?(this.processorBufferSize=1024,this.context=t):(this.audio=new Audio(""),this.audio.src=this.file,this.audio.autoplay=!1,this.audio.preload="auto")}},{key:"load",value:function(){var t=this;return this.loadPromise||(this.loadPromise=new Promise(function(e,o){var r=new XMLHttpRequest;r.open("GET",t.file,!0),r.responseType="arraybuffer",r.onload=function(o){t.context&&!t.playsFile?t.decode(r.response,e):e(t)},r.send()})),this.loadPromise}},{key:"decode",value:function(t,e){var o=this;this.context.decodeAudioData(t,function(t){o.audioBuffer=t,e()})}},{key:"play",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.audio)return this.audio.currentTime=0,this.audio.play(),void(this.audio.volume=t);this.destroyProcessor(),this.processor=this.context.createScriptProcessor(this.processorBufferSize),this.initProcessor(0,t)}},{key:"destroyProcessor",value:function(){this.processor&&(this.processor.onaudioprocess=null,this.processor.disconnect(),this.processor=null)}},{key:"initProcessor",value:function(t,e){var o=this.audioBuffer,r=o.length,i=o.getChannelData(0),a=o.getChannelData(1);this.processor.onaudioprocess=function(e){var o=e.outputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(1);if(r>=t+o.length){for(var s=o.length;s--;)o[s]=i[t+s],n[s]=a[t+s];t+=o.length}else{for(var c=r-t,u=c,l=o.length-c;u--;)o[u]=i[t+u],n[u]=a[t+u];for(var h=l;h--;)n[c+h]=o[c+h]=0;t=r}};var n=this.context.createGain();n.gain.value=e,this.processor.connect(n),n.connect(this.context.destination)}}])&&Z(e.prototype,o),t}();function Q(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var K=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o;return e=t,o=[{key:"getAudioContext",value:function(){return new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext)}},{key:"init",value:function(){if(!$("html").is(".placement")){this.activated=!0;var e=null;t.contextAvailable&&(e=t.getAudioContext()),this.overSound=new J(e,this.overSoundSrc,!0),this.clickSound=new J(e,this.clickSoundSrc,!0),this.overSound.load(),this.clickSound.load(),this.bgmSound=new Audio(""),this.bgmSound.src=this.bgmSrc,this.bgmSound.autoplay=!1,this.bgmSound.preload="preload",this.bgmSound.loop=!0,this.bgmSound.volume=this.bgmvol}}},{key:"over",value:function(){var t=this;this.activated&&i.isPC&&(this.muted||this.overSound.load().then(function(){t.overSound.play()}))}},{key:"click",value:function(){var t=this;this.activated&&(this.muted||this.clickSound.load().then(function(){t.clickSound.play()}))}},{key:"bgm",value:function(){this.activated&&(this.muted||(this.bgmSound.volume=this.bgmvol=1,this.bgmSound.currentTime=0,this.bgmSound.play().then(function(){}).catch(function(){}),this.bgmPlaying=!0))}},{key:"mutebgm",value:function(){var t=this;this.bgmPlaying=!1,requestAnimationFrame(function e(){if(!t.bgmPlaying){if(t.bgmvol-=.1,t.bgmvol<=0)return t.bgmvol=0,t.bgmSound.volume=t.bgmvol,t.bgmSound.pause(),void(t.bgmSound.currentTime=0);requestAnimationFrame(e)}})}}],null&&Q(e.prototype,null),o&&Q(e,o),t}();function tt(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}K.contextAvailable=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext),K.muted=!1,K.overSoundSrc="/assets/sound/over.mp3",K.clickSoundSrc="/assets/sound/click.mp3",K.bgmSrc="/assets/sound/bgm.mp3",K.bgmvol=1;var et=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o;return e=t,o=[{key:"init",value:function(){this.master||(this.master=document.createElement("div"),this.master.id="animationTrigger",document.body.appendChild(this.master))}},{key:"set",value:function(t){var e=this;t.classList.remove("anim");var o=document.createElement("span");o.addEventListener("animationend",function r(a){if(a.stopPropagation(),o.removeEventListener("animationend",r),t.classList.add("anim"),i.isIE){var n=document.createEvent("Event");n.initEvent("anim",!0,!0),t.dispatchEvent(n)}else t.dispatchEvent(new Event("anim"));e.master.removeChild(o)}),this.master.appendChild(o)}}],null&&tt(e.prototype,null),o&&tt(e,o),t}();function ot(t){return(ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function rt(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function it(t,e){return(it=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function at(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var o,r=nt(t);if(e){var i=nt(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return function(t,e){return!e||"object"!==ot(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,o)}}function nt(t){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var st=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&it(t,e)}(s,n);var e,o,a=at(s);function s(t){var e;return function(t,e){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}(this),(e=a.call(this,t)).baseColor=[77/255,77/255,77/255],e.colorChangerNormal=1,e.colorChangerFierce=10,e}return e=s,(o=[{key:"init",value:function(t){var e=this;this.gl=t,this.height=n.baseh;var o=this.node.find(".logo").attr("data-src");this.cubeScale=parseInt(this.node.find(".logo").attr("data-scale")),i.isSP&&(this.cubeScale=parseInt(this.node.find(".logo").attr("data-scalesp")));var r=se.generate();return this.texture=new l(t),this.texture.generate(r,t.REPEAT),this.textureSize=[8,8],new Promise(function(t,r){(new R).load(o).then(function(o){var r=document.createElement("canvas");r.width=o.width,r.height=o.height;var i=r.getContext("2d");i.drawImage(o,0,0),e.setupModel(i.getImageData(0,0,o.width,o.height).data,o.width,o.height,e.cubeScale),r.width=0,r.height=0,t(e)})})}},{key:"setupModel",value:function(t,e,o,a){var s=[];this.colors=[],this.matrices=[],this.invmatrices=[];var c=[];this.matricesSquare=[],this.spreadsSquare=[],this.colorsSquare=[],this.texoffsetsSquare=[],this.colorVariables=[],this.colorWaits=[],this.cubes=0,this.squares=0,this.cubeCount=0,this.zOffset=0,this.cubeGroups=[],this.squareGroups=[];var u,l,h=P.dotscale,d=n.basew,p=n.baseh;if(this.prohibitedPoints=[],i.isSP)for(var g=20;g<22;g++){this.prohibitedPoints[g]=[];for(var m=0;m<d/h;m++)this.prohibitedPoints[g][m]=!0}else for(var b=20;b<22;b++){this.prohibitedPoints[b]=[];for(var y=0;y<d/h;y++)this.prohibitedPoints[b][y]=!0}var w,x,S=0,C=0,M=0,O=0,E=0,k=0,T=i.isSP?2:1,R=(2*P.dotscale-a)*i.pixelRatio/T;l=new W(a);for(var A=Math.floor((this.sw/i.pixelRatio-d)/(2*h)),q=Math.floor((this.sh/i.pixelRatio-p)/(2*h)),I=d/h+4,F=p/h+4,B=2*A+I,_=2*q+F,L=Math.floor(this.sw/(i.pixelRatio*h))-B,D=Math.floor(this.sh/(i.pixelRatio*h))-_,$=0;$<20;$++){for(var G=Math.floor(B*Math.random()),j=Math.floor(_*Math.random());A<=G&&G<A+I&&q<=j&&j<q+F;)G=Math.floor(B*Math.random()),j=Math.floor(_*Math.random());G=L+G-.5,j=D+j-.5,c.push(G,j,0),this.spreadsSquare.push(h,h),this.texoffsetsSquare.push(0,0);var N=$%(v.colors.length/3);this.colorsSquare.push(v.colors[3*N+0],v.colors[3*N+1],v.colors[3*N+2]),this.squares+=1}S=Math.floor(this.sw/i.pixelRatio/(2*h)),C=Math.floor(this.sh/i.pixelRatio/(2*h)),w=r.a.fromTranslation(r.a.create(),[(I-0)/2*h,(F-0)/2*h,0]),l.setBaseMatrix(w),x=c.length;for(var z=0;z<x;z+=3){var U=r.a.fromScaling(r.a.create(),[h,h,h]);r.a.translate(U,U,[c[z]-S,c[z+1]-C,.01]),l.addChild(U)}this.squareGroups.push(l),this.colorSquares=this.squares,M=1e4,O=-1e4,E=1e4,k=-1e4,s=[],u=new W(this.cubeScale);for(var Y=0;Y<o;Y++)for(var V=0;V<e;V++)255==t[Y*e*4+4*V]&&(s.push(V+.5,Y+.5,-.5),M>V?M=V:O<V&&(O=V),E>Y?E=Y:k<Y&&(k=Y),this.colors=this.colors.concat(this.baseColor),this.cubes++);S=(O+M+1)/2,C=(k+E+1)/2,w=r.a.fromTranslation(r.a.create(),[(d-parseInt(this.node.find(".logo").css("width")))/2+S*a,o*P.dotscale*2-o*a-R+C*a,-a/2]),u.setBaseMatrix(w),x=s.length;for(var X=0;X<x;X+=3){var H=r.a.fromScaling(r.a.create(),[a,a,a]);r.a.translate(H,H,[s[X]-S,s[X+1]-C,0]),u.addChild(H)}this.cubeGroups.push(u),M=1e4,O=-1e4,E=1e4,k=-1e4,s=[],u=new W(this.cubeScale);for(var Z=0;Z<o;Z++)for(var J=0;J<e;J++)204==t[Z*e*4+4*J]&&(s.push(J+.5,Z+.5,-.5),M>J+.5?M=J+.5:O<J+.5&&(O=J+.5),E>Z+.5?E=Z+.5:k<Z+.5&&(k=Z+.5),this.colors=this.colors.concat(this.baseColor),this.colorVariables.push(this.cubes),this.colorWaits.push(0),this.cubes++);S=(O+M+0)/2,C=(k+E+0)/2,w=r.a.fromTranslation(r.a.create(),[Math.floor((d-parseInt(this.node.find(".logo").css("width")))/2+S*a),o*P.dotscale*2-o*a-R+C*a-0,-a/2]),u.setBaseMatrix(w),x=s.length;for(var Q=0;Q<x;Q+=3){var K=r.a.fromScaling(r.a.create(),[a,a,a]);r.a.translate(K,K,[s[Q]-S,s[Q+1]-C,0]),u.addChild(K)}this.cubeGroups.push(u),M=1e4,O=-1e4,E=1e4,k=-1e4,s=[],u=new W(this.cubeScale);for(var tt=0;tt<o;tt++)for(var et=0;et<e;et++)153==t[tt*e*4+4*et]&&(s.push(et+.5,tt+.5,-.5),M>et+.5?M=et+.5:O<et+.5&&(O=et+.5),E>tt+.5?E=tt+.5:k<tt+.5&&(k=tt+.5),this.colors=this.colors.concat(this.baseColor),this.colorVariables.push(this.cubes),this.colorWaits.push(0),this.cubes++);S=(O+M+0)/2,C=(k+E+0)/2,w=r.a.fromTranslation(r.a.create(),[Math.floor((d-parseInt(this.node.find(".logo").css("width")))/2+S*a),o*P.dotscale*2-o*a-R+C*a-0,-a/2]),u.setBaseMatrix(w),x=s.length;for(var ot=0;ot<x;ot+=3){var rt=r.a.fromScaling(r.a.create(),[a,a,a]);r.a.translate(rt,rt,[s[ot]-S,s[ot+1]-C,0]),u.addChild(rt)}this.cubeGroups.push(u),M=1e4,O=-1e4,E=1e4,k=-1e4,s=[],u=new W(this.cubeScale);for(var it=0;it<o;it++)for(var at=0;at<e;at++)102==t[it*e*4+4*at]&&(s.push(at+.5,it+.5,-.5),M>at+.5?M=at+.5:O<at+.5&&(O=at+.5),E>it+.5?E=it+.5:k<it+.5&&(k=it+.5),this.colors=this.colors.concat(this.baseColor),this.colorVariables.push(this.cubes),this.colorWaits.push(0),this.cubes++);S=(O+M+0)/2,C=(k+E+0)/2,w=r.a.fromTranslation(r.a.create(),[Math.floor((d-parseInt(this.node.find(".logo").css("width")))/2+S*a),o*P.dotscale*2-o*a-R+C*a-0,-a/2]),u.setBaseMatrix(w),x=s.length;for(var nt=0;nt<x;nt+=3){var st=r.a.fromScaling(r.a.create(),[a,a,a]);r.a.translate(st,st,[s[nt]-S,s[nt+1]-C,0]),u.addChild(st)}this.cubeGroups.push(u),M=1e4,O=-1e4,E=1e4,k=-1e4,s=[],u=new W(this.cubeScale);for(var ct=0;ct<o;ct++)for(var ut=0;ut<e;ut++)51==t[ct*e*4+4*ut]&&(s.push(ut+.5,ct+.5,-.5),M>ut+.5?M=ut+.5:O<ut+.5&&(O=ut+.5),E>ct+.5?E=ct+.5:k<ct+.5&&(k=ct+.5),this.colors=this.colors.concat(this.baseColor),this.colorVariables.push(this.cubes),this.colorWaits.push(0),this.cubes++);S=(O+M+0)/2,C=(k+E+0)/2,w=r.a.fromTranslation(r.a.create(),[Math.floor((d-parseInt(this.node.find(".logo").css("width")))/2+S*a),o*P.dotscale*2-o*a-R+C*a-0,-a/2]),u.setBaseMatrix(w),x=s.length;for(var lt=0;lt<x;lt+=3){var ht=r.a.fromScaling(r.a.create(),[a,a,a]);r.a.translate(ht,ht,[s[lt]-S,s[lt+1]-C,0]),u.addChild(ht)}this.cubeGroups.push(u),this.logoCubeIndex=this.cubes;var ft=a-this.textureSize[0];M=1e4,O=-1e4,E=1e4,k=-1e4,s=[],c=[],u=new W(this.cubeScale),l=new W(this.cubeScale);for(var dt=1;dt<o-1;dt++)for(var vt=1;vt<e-1;vt++)0==t[dt*e*4+4*vt]&&(s.push(vt+.5,dt+.5,-1.5),M>vt+.5?M=vt+.5:O<vt+.5&&(O=vt+.5),E>dt+.5?E=dt+.5:k<dt+.5&&(k=dt+.5),this.colors.push(54/255,54/255,54/255),this.cubes++,c.push(vt+.5,dt+.5,0),this.spreadsSquare.push(a*T,a*T),this.texoffsetsSquare.push(0,ft),this.colorsSquare.push(0,0,0),this.squares+=1);S=(O+M+0)/2,C=(k+E+0)/2,w=r.a.fromTranslation(r.a.create(),[Math.floor((d-parseInt(this.node.find(".logo").css("width")))/2+S*a),o*P.dotscale*2-o*a-R+C*a,3*-a/2-.01]),u.setBaseMatrix(w),w=r.a.fromTranslation(r.a.create(),[Math.floor((d-parseInt(this.node.find(".logo").css("width")))/2+S*a),o*P.dotscale*2-o*a-R+C*a,0]),l.setBaseMatrix(w),x=s.length;for(var pt=0;pt<x;pt+=3){var gt=r.a.fromScaling(r.a.create(),[a,a,3*a]);r.a.translate(gt,gt,[s[pt]-S,s[pt+1]-C,0]),u.addChild(gt)}x=c.length;for(var mt=0;mt<x;mt+=3){var bt=r.a.fromScaling(r.a.create(),[a,a,0]);r.a.translate(bt,bt,[c[mt]-S,c[mt+1]-C,0]),l.addChild(bt)}this.cubeGroups.push(u),this.squareGroups.push(l),this.fixedSquareIndex=this.squares,this.fixedCubeGroupIndex=this.cubeGroups.length,M=-.5,O=e+.5,E=-.5,k=o+.5,s=[],c=[],u=new W(this.cubeScale),l=new W(this.cubeScale);for(var yt=-1;yt<e+1;yt++)s.push(yt+.5,-.5,-1.5,yt+.5,o+.5,-1.5),this.colors.push(54/255,54/255,54/255,54/255,54/255,54/255),this.cubes+=2,c.push(yt+.5,-.5,0,yt+.5,o+.5,0),this.spreadsSquare.push(a*T,a*T,a*T,a*T),this.texoffsetsSquare.push(0,ft,0,ft),this.colorsSquare.push(0,0,0,0,0,0),this.squares+=2;for(var wt=0;wt<o;wt++)s.push(-.5,wt+.5,-1.5,e+.5,wt+.5,-1.5),this.colors.push(54/255,54/255,54/255,54/255,54/255,54/255),this.cubes+=2,c.push(-.5,wt+.5,0,e+.5,wt+.5,0),this.spreadsSquare.push(a*T,a*T,a*T,a*T),this.texoffsetsSquare.push(0,ft,0,ft),this.colorsSquare.push(0,0,0,0,0,0),this.squares+=2;S=(O+M+0)/2,C=(k+E+0)/2,w=r.a.fromTranslation(r.a.create(),[Math.floor((d-parseInt(this.node.find(".logo").css("width")))/2+S*a),o*P.dotscale*2-o*a-R+C*a,3*-a/2-.01]),u.setBaseMatrix(w),w=r.a.fromTranslation(r.a.create(),[Math.floor((d-parseInt(this.node.find(".logo").css("width")))/2+S*a),o*P.dotscale*2-o*a-R+C*a,0]),l.setBaseMatrix(w),x=s.length;for(var xt=0;xt<x;xt+=3){var St=r.a.fromScaling(r.a.create(),[a,a,3*a]);r.a.translate(St,St,[s[xt]-S,s[xt+1]-C,0]),u.addChild(St)}x=c.length;for(var Ct=0;Ct<x;Ct+=3){var Mt=r.a.fromScaling(r.a.create(),[a,a,0]);r.a.translate(Mt,Mt,[c[Ct]-S,c[Ct+1]-C,0]),l.addChild(Mt)}this.cubeGroups.push(u),this.squareGroups.push(l),this.vboColors=new f(this.gl),this.vboMatrices=new f(this.gl),this.vboInvMatrices=new f(this.gl),this.vboColors.generate(new Float32Array(this.colors),this.gl.DYNAMIC_DRAW),this.matricesBase=new Float32Array(16*this.cubes),this.vboMatrices.generate(this.matricesBase,this.gl.DYNAMIC_DRAW),this.invmatricesBase=new Float32Array(16*this.cubes),this.vboInvMatrices.generate(this.invmatricesBase,this.gl.DYNAMIC_DRAW);for(var Ot=0;Ot<this.cubes;Ot++){var Et=16*Ot*4;this.matrices.push(new Float32Array(this.matricesBase.buffer,Et,16)),this.invmatrices.push(new Float32Array(this.invmatricesBase.buffer,Et,16))}this.cubeCount=this.cubes,this.squareCount=this.squares,this.vboMatricesSquare=new f(this.gl),this.vboSpreadsSquare=new f(this.gl),this.vboColorsSquare=new f(this.gl),this.vboTexoffsetsSquare=new f(this.gl),this.vboSpreadsSquare.generate(new Float32Array(this.spreadsSquare)),this.vboColorsSquare.generate(new Float32Array(this.colorsSquare)),this.vboTexoffsetsSquare.generate(new Float32Array(this.texoffsetsSquare)),this.matricesBaseSquare=new Float32Array(16*this.squares),this.vboMatricesSquare.generate(this.matricesBaseSquare,this.gl.DYNAMIC_DRAW);for(var Pt=0;Pt<this.squares;Pt++){var kt=16*Pt*4;this.matricesSquare.push(new Float32Array(this.matricesBaseSquare.buffer,kt,16))}}},{key:"setupScene",value:function(){var t,e=this;this.colorChanger=this.colorChangerNormal;var o=function o(){t||(e.colorChanger-=.2,e.colorChanger<=e.colorChangerNormal&&(e.colorChanger=e.colorChangerNormal,t=!0),requestAnimationFrame(o))},r=this.node.find(".cover"),a=this.node.find(".logo"),n=this.node.find(".button");r.on("hover",function(){t=!0,e.colorChanger=e.colorChangerFierce,e.hover(),n.addClass("hover"),K.over()}).on("hoverend",function(){t=!1,requestAnimationFrame(o),e.hoverend(),n.removeClass("hover")}),L(r,function(){(new Y).start(2e3).then(function(){t=!1,requestAnimationFrame(o)}),$(e).trigger("logoClicked"),a.off("hover hoverend").addClass("clicked"),n.off("hover hoverend").addClass("clicked"),r.off("hover hoverend").addClass("clicked"),e.node.find(".remarks").addClass("hidden"),n.removeClass("hover"),e.hover(),e.go(),et.set(r[0]),r.on("anim",function(){K.click(),K.bgm(),r.remove()})}),n.on("hover",function(){t=!0,e.colorChanger=e.colorChangerFierce,e.hover(),r.addClass("hover")}).on("hoverend",function(){t=!1,requestAnimationFrame(o),e.hoverend(),r.removeClass("hover")}),i.isSP||L(n,function(){(new Y).start(2e3).then(function(){t=!1,requestAnimationFrame(o)}),$(e).trigger("logoClicked"),a.off("hover hoverend").addClass("clicked"),n.off("hover hoverend").addClass("clicked"),r.off("hover hoverend").addClass("clicked"),n.removeClass("hover"),e.node.find(".remarks").addClass("hidden"),e.hover(),e.go(),r.remove()})}},{key:"go",value:function(){for(var t=this,e=0,o=0,i=0,a=0,n=5*this.cubeScale,s=[],c=[],u=[],l=[],h=[],f=[],d=6*this.cubeScale,v=0;v<this.cubeGroups.length;v++)s.push(this.zOffset),c.push(0),u.push(.2+.3*Math.random()),l.push(0),h.push(-.001-.01*Math.random()),f[v]=-Math.PI/2+2*Math.PI;f[0]=-Math.PI/2+3*Math.PI;var p=0,g=Math.floor(1e3/60),m=!1,b=0,y=function e(f){if(f-p<g)requestAnimationFrame(e);else{p=f,a<.1*(n-i)?a+=.1:a=.1*(n-i),i+=a;for(var d=0;d<t.fixedCubeGroupIndex-1;d+=1){h[d]+=2e-4,l[d]+=h[d],c[d]+=.2,d<o&&(c[d]+=u[d]),s[d]+=c[d];var v=r.a.create(),m=t.cubeGroups[d].getBaseMatrix()[12],y=t.cubeGroups[d].getBaseMatrix()[13],x=t.cubeGroups[d].getBaseMatrix()[14];r.a.translate(v,v,[0,i,s[d]]),r.a.translate(v,v,[m,y,x]),r.a.rotateX(v,v,l[d]),r.a.translate(v,v,[-m,-y,-x]),t.cubeGroups[d].setOffsetMatrix(v)}if(b++>=8){b=0;for(var S=0;S<t.cubeGroups.length;S++)h[S]+=.01*Math.random();requestAnimationFrame(w)}else requestAnimationFrame(e)}},w=function e(o){if(o-p<g)requestAnimationFrame(e);else{p=o,a<.1*(n-i)?a+=.1:a=.1*(n-i),i+=a;for(var u=0;u<t.fixedCubeGroupIndex-1;u+=1){h[u]+=2e-4,l[u]+=h[u],c[u]>0&&c[u]>.1*(d-s[u])?c[u]-=4:c[u]=.1*(d-s[u]),s[u]+=c[u];var f=r.a.create(),v=t.cubeGroups[u].getBaseMatrix()[12],m=t.cubeGroups[u].getBaseMatrix()[13],y=t.cubeGroups[u].getBaseMatrix()[14];r.a.translate(f,f,[0,i,s[u]]),r.a.translate(f,f,[v,m,y]),r.a.rotateX(f,f,l[u]),r.a.translate(f,f,[-v,-m,-y]),t.cubeGroups[u].setOffsetMatrix(f)}b++>=30?(b=0,$(t).trigger("introEnding"),requestAnimationFrame(x),t.ending=!0,t.squareCount=0):requestAnimationFrame(e)}},x=function e(o){if(o-p<g)requestAnimationFrame(e);else{p=o;var u=!0;a<.1*(n-i)?a+=.1:a=.1*(n-i),i+=a;for(var v=0;v<t.fixedCubeGroupIndex-1;v+=1){h[v]<.1*(f[v]-l[v])?(h[v]+=.002,u=!1):(h[v]=.1*(f[v]-l[v]),Math.abs(h[v])<1e-4?(h[v]=0,l[v]=f[v]):u=!1),l[v]+=h[v],0<c[v]&&c[v]<.1*(d-s[v])?(c[v]-=4,u=!1):(c[v]=.1*(d-s[v]),Math.abs(c[v])<.01?(c[v]=0,s[v]=d):u=!1),s[v]+=c[v];var m=r.a.create(),b=t.cubeGroups[v].getBaseMatrix()[12],y=t.cubeGroups[v].getBaseMatrix()[13],w=t.cubeGroups[v].getBaseMatrix()[14];r.a.translate(m,m,[0,i,s[v]]),r.a.translate(m,m,[b,y,w]),r.a.rotateX(m,m,l[v]),r.a.translate(m,m,[-b,-y,-w]),t.cubeGroups[v].setOffsetMatrix(m)}if(u){t.finished=!0;for(var x=0;x<t.fixedCubeGroupIndex-1;x+=1)t.cubeGroups[x].mergeOffsetToBase()}else requestAnimationFrame(e)}};requestAnimationFrame(function i(a){if(!m)if(a-p<g)requestAnimationFrame(i);else{var n,l;p=a,e+=.2,t.zOffset+=e,!m&&t.zOffset>=t.cubeScale&&(m=!0,t.cubeCount=t.logoCubeIndex,t.squareCount=t.colorSquares,$(t).trigger("introMiddlePoint"),requestAnimationFrame(y)),l=t.zOffset>0?0:t.zOffset,m&&(o+=10)>t.fixedCubeGroupIndex&&(o=t.fixedCubeGroupIndex);for(var h=0;h<t.cubeGroups.length;h++)c[h]+=.2,h<o&&(c[h]+=u[h]),s[h]+=c[h];for(n=0;n<t.fixedCubeGroupIndex-1;n+=1){var f=r.a.fromTranslation(r.a.create(),[0,0,s[n]]);t.cubeGroups[n].setOffsetMatrix(f)}var d=r.a.fromTranslation(r.a.create(),[0,0,l-.01]);t.cubeGroups[t.fixedCubeGroupIndex-1].setOffsetMatrix(d),d=r.a.fromTranslation(r.a.create(),[0,0,l]),t.squareGroups[1].setOffsetMatrix(d),0==l&&(t.cubeCount=t.logoCubeIndex,t.squareCount=t.fixedSquareIndex),requestAnimationFrame(i)}})}},{key:"hover",value:function(){var t;this.zOffset=-this.cubeScale*(i.isSP?2:1);var e=r.a.fromTranslation(r.a.create(),[0,0,this.zOffset]);for(t=0;t<this.fixedCubeGroupIndex;t++)this.cubeGroups[t].setOffsetMatrix(e);e=r.a.fromTranslation(r.a.create(),[0,0,this.zOffset+.01]),this.squareGroups[1].setOffsetMatrix(e),this.vboMatrices.update(this.matricesBase),this.vboMatricesSquare.update(this.matricesBaseSquare)}},{key:"hoverend",value:function(){var t;this.zOffset=0;var e=r.a.fromTranslation(r.a.create(),[0,0,this.zOffset]);for(t=0;t<this.fixedCubeGroupIndex;t++)this.cubeGroups[t].setOffsetMatrix(e);this.squareGroups[1].setOffsetMatrix(e),this.vboMatrices.update(this.matricesBase),this.vboMatricesSquare.update(this.matricesBaseSquare)}},{key:"update",value:function(){var t,e=this;if(this.updateColor(),!this.finished){t=0;for(var o=function(o){var i=e.cubeGroups[o];i.matrices.forEach(function(o,a){r.a.multiply(e.matrices[a+t],i.matrix,o),r.a.invert(e.invmatrices[a+t],o)}),t+=i.matrices.length},i=0;i<this.cubeGroups.length;i++)o(i);this.vboMatrices.update(this.matricesBase),this.vboInvMatrices.update(this.invmatricesBase)}if(!this.ending){t=0;for(var a=function(o){var i=e.squareGroups[o];i.matrices.forEach(function(o,a){r.a.multiply(e.matricesSquare[a+t],i.matrix,o)}),t+=i.matrices.length},n=0;n<this.squareGroups.length;n++)a(n);this.vboMatricesSquare.update(this.matricesBaseSquare)}}},{key:"updateColor",value:function(){var t=this;if(this.colorVariables.forEach(function(e,o){if(!(--t.colorWaits[o]>0))if(t.colors[3*e]==t.baseColor[0]){if(Math.random()<.01*t.colorChanger){var r=Math.floor(Math.random()*v.colors.length/3);t.colors[3*e+0]=v.colors[3*r+0],t.colors[3*e+1]=v.colors[3*r+1],t.colors[3*e+2]=v.colors[3*r+2],t.colorWaits[o]=(10+30*Math.random())/t.colorChanger}}else t.colors[3*e+0]=t.baseColor[0],t.colors[3*e+1]=t.baseColor[1],t.colors[3*e+2]=t.baseColor[2],t.colorWaits[o]=(10+30*Math.random())/t.colorChanger}),this.vboColors.update(new Float32Array(this.colors)),!this.ending){var e=n.basew,o=n.baseh;i.isSP&&(e=288,o=228);for(var a=P.dotscale,s=Math.floor((this.sw/i.pixelRatio-e)/(2*a)),c=Math.floor((this.sh/i.pixelRatio-o)/(2*a)),u=e/a+4,l=o/a+4,h=2*s+u,f=2*c+l,d=this.squareGroups[0].matrices.length,p=Math.floor(this.sw/i.pixelRatio/(2*a)),g=Math.floor(this.sh/i.pixelRatio/(2*a)),m=Math.floor(this.sw/(i.pixelRatio*a))-h,b=Math.floor(this.sh/(i.pixelRatio*a))-f,y=0;y<d;y++)if(Math.random()<.01){for(var w=Math.floor(h*Math.random()),x=Math.floor(f*Math.random());s<=w&&w<s+u&&c<=x&&x<c+l;)w=Math.floor(h*Math.random()),x=Math.floor(f*Math.random());w=m+w-.5,x=b+x-.5;var S=r.a.fromScaling(r.a.create(),[a,a,a]);r.a.translate(this.squareGroups[0].matrices[y],S,[w-p,x-g,.01])}this.vboMatricesSquare.update(this.matricesBaseSquare)}}},{key:"resize",value:function(t,e){this.sw=t,this.sh=e}},{key:"setYOffset",value:function(t){for(var e=this,o=0,i=function(i){var a=e.cubeGroups[i],n=r.a.fromTranslation(r.a.create(),[0,t,0]);a.setOffsetMatrix(n),a.matrices.forEach(function(t,i){r.a.multiply(e.matrices[i+o],a.matrix,t)}),o+=a.matrices.length},a=0;a<this.cubeGroups.length;a++)i(a);this.vboMatrices.update(this.matricesBase)}},{key:"setNodeOffset",value:function(t){this.node.css("top",t)}},{key:"checkMovablePoint",value:function(t,e){var o=t.length;for(e/=P.dotscale;o--;){var i=t[o].to,a=t[o].offsets,n=!1;if(0==a.w||0==a.h)this.prohibitedPoints[i[1]-e]&&this.prohibitedPoints[i[1]-e][i[0]]&&t.splice(o,1);else{for(var s=a.t-1;s<=a.b;s++){for(var c=a.l-1;c<=a.r;c++)if(this.prohibitedPoints[i[1]-e+s]&&this.prohibitedPoints[i[1]-e+s][i[0]+c]){t.splice(o,1),n=!0;break}if(n)break}if(!n){var u=t[o].data;if(r.b.length([u.dir[0],u.dir[1]])<1){var l=P.dotscale,h=i[1]-e+a.t-1,f=0+x.areaw;u.size>.5*l*H.scaleFactor&&0<=h&&h<this.height/l&&(i[0]+a.l>f||0>i[0]+a.r||t.splice(o,1))}}}}return t}}])&&rt(e.prototype,o),s}();function ct(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}o(187);var ut=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e}var e,o;return e=t,(o=[{key:"init",value:function(t,e,o,r){this.data=t,this.renderingOffset=r,this.point=e,this.setup(e,o),this.frame=0}},{key:"setup",value:function(t,e){var o=this;this.left=1e5,this.right=-1e5,this.top=1e5,this.bottom=-1e5,this.width=0,this.height=0,this.matrices=[],this.invmatrices=[];var i=this.data.maxCubes;this.colors=new Array(3*i),this.matricesBase=new Float32Array(16*i),this.invmatricesBase=new Float32Array(16*i);for(var a=0;a<i;++a){var n=16*a*4;this.matrices.push(new Float32Array(this.matricesBase.buffer,n,16)),this.invmatrices.push(new Float32Array(this.invmatricesBase.buffer,n,16))}var s=this.data.size;this.rotation=e*Math.PI/180;var c=r.a.fromTranslation(r.a.create(),t);r.a.rotateZ(c,c,this.rotation),this.frames=[];for(var u=!1,l=!1,h=0;h<this.data.totalFrames;h++){var d=new W(s);d.setBaseMatrix(c),this.frames.push(d);for(var v=0;v<this.data.frames[h].length;v++)d.addChild(this.data.frames[h][v]);d.width>0&&(u=!0,this.left>d.left&&(this.left=d.left),this.right<d.right&&(this.right=d.right)),d.height>0&&(l=!0,this.top>d.top&&(this.top=d.top),this.bottom<d.bottom&&(this.bottom=d.bottom))}u&&(this.width=this.right-this.left),l&&(this.height=this.bottom-this.top),this.invmatrices.forEach(function(t,e){r.a.invert(t,o.data.matricesCube[e])}),this.vboColors=new f(this.gl),this.vboMatrices=new f(this.gl),this.vboInvMatrices=new f(this.gl),this.vboColors.generate(new Float32Array(this.colors),this.gl.DYNAMIC_DRAW),this.vboMatrices.generate(this.matricesBase,this.gl.DYNAMIC_DRAW),this.vboInvMatrices.generate(this.invmatricesBase)}},{key:"resetAnimation",value:function(){this.finished=!1,this.frame=0}},{key:"hasNextFrame",value:function(){return 1!=this.data.totalFrames&&(!(this.frame+1>=this.data.totalFrames)||this.data.loopFrame>-1)}},{key:"nextFrame",value:function(){if(++this.frame,this.frame==this.data.totalFrames&&this.data.totalFrames>1&&(this.frame=this.data.loopFrame,this.coord&&(this.loopCount++,this.loopCount%this.coord.iteration==0))){var t=this.frames[this.frame].getBaseMatrix(),e=r.a.fromTranslation(r.a.create(),[t[12],t[13],t[14]]);r.a.rotateZ(e,e,this.rotation+this.coord.fill*Math.floor(this.loopCount/this.coord.iteration)*Math.PI/180),this.frames.forEach(function(t){t.setBaseMatrix(e)})}var o=this.frames[this.frame];if(this.coord){var i=this.data.animations[this.frame],a=r.c.rotateZ(r.c.create(),i,[0,0,0],this.rotation+this.coord.fill*Math.floor(this.loopCount/this.coord.iteration)*Math.PI/180);o.setOffsetMatrix(r.a.fromTranslation(r.a.create(),[a[0]*this.data.size,a[1]*this.data.size,a[2]*this.data.size])),o.mergeOffsetToBase()}if(this.cubeCount=o.matrices.length,this.cubeCount>0){for(var n=this.data.frameOffsets[this.frame],s=this.cubeCount,c=0;c<s;c++)r.a.multiply(this.matrices[c],o.matrix,this.data.matricesCube[n+c]);this.colors=this.data.colors.slice(3*n,3*(n+s)),this.vboColors.update(new Float32Array(this.colors)),this.vboMatrices.update(this.matricesBase)}}},{key:"start",value:function(){this.starting||(this.starting=!0,this.frame=-1,this.baseTime=performance.now(),this.loopCount=0,this.nextFrame())}},{key:"updateMatrixReserved",value:function(t){this.rotation=t.rotation;var e=r.a.fromTranslation(r.a.create(),t.position);r.a.rotateZ(e,e,t.rotation),this.frames.forEach(function(t){t.setBaseMatrix(e)});for(var o=this.data.frameOffsets[this.frame],i=this.cubeCount,a=0;a<i;a++)r.a.multiply(this.matrices[a],this.frames[this.frame].matrix,this.data.matricesCube[o+a]);this.vboMatrices.update(this.matricesBase)}},{key:"update",value:function(){if(!this.finished&&this.starting){var t=performance.now();t-this.baseTime>this.data.durations[this.frame]&&(this.baseTime=t,this.hasNextFrame()?this.nextFrame():(this.finished=!0,this.data.endsEmpty&&$(this).trigger("disappeared")))}}},{key:"getXY",value:function(){var t=this.frames[this.frame];return{x:t.matrix[12]/P.dotscale,y:t.matrix[13]/P.dotscale}}},{key:"skipCoord",value:function(t,e){var o=r.a.fromTranslation(r.a.create(),t);r.a.rotateZ(o,o,e),this.frames.forEach(function(t){t.setBaseMatrix(o)})}}])&&ct(e.prototype,o),t}(),lt=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e.id,this.x=e.x,this.y=e.y,this.iteration=e.iteration,this.fill=e.fill,this.fillx=e.fillx,this.filly=e.filly,this.rot=e.rot,this.data=H.getData(e.id)};function ht(t){return(ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ft(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function dt(t,e){return(dt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var o,r=pt(t);if(e){var i=pt(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return function(t,e){return!e||"object"!==ht(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,o)}}function pt(t){return(pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var gt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&dt(t,e)}(s,n);var e,o,r,a=vt(s);function s(){var t;!function(t,e){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}(this),(t=a.call(this,$())).freedotscale=P.dotscale,t.leftOffset=x.leftOffset,t.areaw=x.areaw,t.areah=x.areah,t.w=x.W,t.h=x.H,t.doodlePlaceW=Math.floor(t.areaw/4),t.doodlePlaceH=Math.floor(t.areah/2);for(var e=0;e<t.h;)e+=t.doodlePlaceH;t.doodlePlaceTopBase=Math.ceil(-(e-t.areah)/2),t.doodlePlaceBottomBase=t.doodlePlaceTopBase+e+Math.floor(n.contentMargin/t.freedotscale),t.doodlePlaceTop=t.doodlePlaceTopBase,t.doodlePlaceBottom=t.doodlePlaceBottomBase,t.doodlePlaceGap=t.doodlePlaceBottom-t.doodlePlaceTop;for(var o=0;o<t.w;)o+=t.doodlePlaceW;return t.coordIndexStart=0,t.coordIndexEnd=0,t}return e=s,r=[{key:"setInstance",value:function(t){this.instance=t}},{key:"getData",value:function(t){return this.datalist.find(function(e){return e.name==t})}},{key:"reserve",value:function(t){var e=this;this.reservations.push(t);var o=t.name;this.datalist.forEach(function(r){if(o==r.name){var i=new ut(e.instance.gl);e.instance.doodlesReserved.push({r:t,doodle:i}),i.init(r,t.position,t.rotation,{l:0,r:0,t:0,b:0}),i.start()}})}}],(o=[{key:"init",value:function(t){var e=this;return new Promise(function(o,r){e.gl=t,e.doodlesReserved=[],e.doodlesFree=[],e.doodlesFreeForehead=[],e.doodles=[],e.loadList(o),e.setupModel()})}},{key:"loadList",value:function(t){var e,o=this;e=location.hostname.indexOf(".com")>-1?i.isSP?"../assets/doodlessp.json":"../assets/doodles.json":location.hostname.indexOf(".jp")>-1?i.isSP?"../assets/doodlessp.json?"+(new Date).getTime():"../assets/doodles.json?"+(new Date).getTime():i.isSP?"../assets/json/doodlessp.json":"../assets/json/doodles.json",$.ajax({url:e,dataType:"json"}).done(function(e){var r=[],i=e.doodles;Object.keys(i).forEach(function(e){var a=new H,n=a.load(i[e]);r.push(n),n.then(function(e){var r=a.name;s.reservations.forEach(function(t){if(r==t.name){var i=new ut(o.gl);o.doodlesReserved.push({r:t,doodle:i}),i.init(e,t.position,t.rotation,{l:0,r:0,t:0,b:0}),i.start()}}),t(o)}),s.datalist.push(a)}),Promise.all(r).then(function(){var r;r=e.layout,o.doodleCoords=[],o.doodleCoordsForehead=[],r.forEach(function(t){t.y<0?o.doodleCoordsForehead.push(new lt(t)):o.doodleCoords.push(new lt(t))}),t(o)}).catch(function(){})})}},{key:"setupModel",value:function(){ae.placement||(this.scrollOffsetBase=ae.camera.getOffset()[1],this.scrollOffset=0,this.scrollCount=0,this.renderingIndex=0,this.renderingIndexCount=0)}},{key:"prepare",value:function(t){if(!ae.placement){this.contentHeights=t,this.contentTotalHeight=this.contentHeights[t.length-1];for(var e=this.coordIndexStart;;){var o=this.doodleCoords[e++];if(o.onscreen){if(this.doodleCoords.length==e)break}else{if(!(this.doodlePlaceTop<o.y&&o.y<this.doodlePlaceBottom))break;if(this.generateDoodle(o),this.coordIndexEnd=e,this.doodleCoords.length==e)break}}this.generateForehead()}}},{key:"generateForehead",value:function(){for(var t=0;t<this.doodleCoordsForehead.length;){var e=this.doodleCoordsForehead[t++];this.generateDoodle(e)}}},{key:"start",value:function(){}},{key:"updateReserved",value:function(){ae.placement||this.doodlesReserved.forEach(function(t){s.reservations.forEach(function(e){t.r==e&&t.doodle.updateMatrixReserved(e)})})}},{key:"update",value:function(){var t=this;if(!ae.placement){var e,o,r,i,a=Math.floor(ae.scrollTop/this.freedotscale);o=(e=this.doodlePlaceTopBase+a)+this.doodlePlaceGap,i=(r=-this.leftOffset)+this.w;for(var n,s,c=this.coordIndexStart,u=this.coordIndexEnd,l=c;l<u;l++){var h=l%this.doodleCoords.length,f=this.doodleCoords[h],d=f.view;if(d){var v=d.getXY(),p=v.x,g=v.y;if(e>=g||g>=o){f.onscreen=!1;for(var m=this.doodlesFree.length;m--;)if(this.doodlesFree[m]==d){this.doodlesFree.splice(m,1);break}if(e>=g){if(this.coordIndexStart==l){this.coordIndexStart++;var b=this.coordIndexStart;for(f.view=null;;){var y=b%this.doodleCoords.length;b++;var w=this.doodleCoords[y];if(w.onscreen||!w.view)break;if(w.view=null,this.coordIndexStart>=this.coordIndexEnd)break;this.coordIndexStart++}if(this.coordIndexStart>0&&this.doodleCoordsForehead.length>0){for(var x=this.doodleCoordsForehead.length;x--;)this.doodleCoordsForehead[x].onscreen=!1,this.doodleCoordsForehead[x].view=null;this.doodlesFreeForehead=[]}}}else if(o<=g&&this.coordIndexEnd-1==l){this.coordIndexEnd--;var S=this.coordIndexEnd-1;if(f.view=null,S>=0)for(;;){var C=S%this.doodleCoords.length;S--;var M=this.doodleCoords[C];if(M.onscreen||!M.view)break;if(M.view=null,this.coordIndexEnd--,0==S)break}}}else{var O,E;(r>p+d.right/this.freedotscale||p+d.left/this.freedotscale>i)&&(r>p+d.right/this.freedotscale?null===(O=f.view)||void 0===O||O.skipCoord([(i-d.left/this.freedotscale)*this.freedotscale,f.view.point[1],f.view.point[2]],f.view.rotation):null===(E=f.view)||void 0===E||E.skipCoord([(r-d.right/this.freedotscale)*this.freedotscale,f.view.point[1],f.view.point[2]],f.view.rotation))}}else f.y<0&&c>=this.doodleCoords.length&&this.coordIndexStart++}for(n=this.coordIndexEnd%this.doodleCoords.length,s=Math.floor(this.coordIndexEnd/this.doodleCoords.length);;){var P=this.doodleCoords[n];if(P.onscreen){this.coordIndexEnd++;break}var k=s*this.contentTotalHeight/this.freedotscale,T=P.y+k;if(P.y<0&&k>0)this.coordIndexEnd++,n=this.coordIndexEnd%this.doodleCoords.length,s=Math.floor(this.coordIndexEnd/this.doodleCoords.length);else{if(!(e<=T&&T<=o))break;this.generateDoodle(P,k),this.coordIndexEnd++,n=this.coordIndexEnd%this.doodleCoords.length,s=Math.floor(this.coordIndexEnd/this.doodleCoords.length)}}if(this.coordIndexStart>0)for(n=(this.coordIndexStart-1)%this.doodleCoords.length,s=Math.floor((this.coordIndexStart-1)/this.doodleCoords.length);;){var R=this.doodleCoords[n];if(R.onscreen)break;var A=s*this.contentTotalHeight/this.freedotscale,q=R.y+A;if(R.y<0&&A>0)this.coordIndexStart--,n=(this.coordIndexStart-1)%this.doodleCoords.length,s=Math.floor((this.coordIndexStart-1)/this.doodleCoords.length);else{if(!(e<=q&&q<=o))break;if(this.generateDoodle(R,A),this.coordIndexStart--,this.coordIndexStart<=0)break;n=(this.coordIndexStart-1)%this.doodleCoords.length,s=Math.floor((this.coordIndexStart-1)/this.doodleCoords.length)}}0==this.coordIndexStart&&0==this.doodlesFreeForehead.length&&this.generateForehead();for(var I=this.doodlesFree.length;I--;){var F=this.doodlesFree[I];if(!F.starting){var B=F.frames[0].matrix[13]-a*this.freedotscale;-this.areah*this.freedotscale*2<B&&B<this.areah*this.freedotscale*2&&F.start()}F.update()}for(I=this.doodlesFreeForehead.length;I--;){var _=this.doodlesFreeForehead[I];if(!_.starting){var L=_.frames[0].matrix[13]-a*this.freedotscale;-this.areah*this.freedotscale*2<L&&L<this.areah*this.freedotscale*2&&_.start()}_.update()}for(I=this.doodlesReserved.length;I--;)this.doodlesReserved[I].doodle.update();this.doodles=this.doodlesFree.slice(),this.doodlesFreeForehead.forEach(function(e){t.doodles.unshift(e)}),this.doodlesReserved.forEach(function(e){t.doodles.unshift(e.doodle)})}}},{key:"generateDoodle",value:function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t.onscreen=!0;var r=t.data,i=t.rot,a=t.x,n=t.y+o;r.using++;var s=new ut(this.gl);s.coord=t,t.view=s,t.y<0?this.doodlesFreeForehead.push(s):this.doodlesFree.push(s),s.init(r,[a*this.freedotscale,n*this.freedotscale,0],i,{l:0,r:0,t:0,b:0}),r.startsEmpty||s.start(),$(s).on("disappeared",function(t){for(var o=e.doodlesFree.length;o--;)if(e.doodlesFree[o]==s){e.doodlesFree[o].data.using--,e.doodlesFree[o].coord.onscreen=!1,e.doodlesFree.splice(o,1);break}})}},{key:"resetIndex",value:function(){for(var t=this.doodlesFree.length;t--;)this.doodlesFree[t].coord.onscreen=!1;this.doodlesFree=[];var e=Math.floor(ae.scrollTop/this.freedotscale);this.doodlePlaceTop=this.doodlePlaceTopBase+e,this.doodlePlaceBottom=this.doodlePlaceTop+this.doodlePlaceGap,this.coordIndexStart=this.coordIndexEnd=-1;for(var o=0;;){var r=this.doodleCoords[o];if(this.doodlePlaceTop<r.y&&r.y<this.doodlePlaceBottom?(this.generateDoodle(r),this.coordIndexEnd=o):this.coordIndexStart==this.coordIndexEnd&&(this.coordIndexStart=this.coordIndexEnd=o),o++,this.doodleCoords.length==o)break}-1==this.coordIndexStart&&(this.coordIndexStart=0)}},{key:"resetRendering",value:function(){this.cubeCount=0,this.renderingIndex=-1,this.renderingIndexCount+=10}},{key:"hasNext",value:function(){return this.renderingIndex+1<Math.min(this.renderingIndexCount,this.doodles.length)}},{key:"next",value:function(){this.renderingIndex++,this.vboColors=this.doodles[this.renderingIndex].vboColors,this.vboMatrices=this.doodles[this.renderingIndex].vboMatrices,this.vboInvMatrices=this.doodles[this.renderingIndex].vboInvMatrices,this.cubeCount=this.doodles[this.renderingIndex].cubeCount}},{key:"resize",value:function(t,e){}}])&&ft(e.prototype,o),r&&ft(e,r),s}();function mt(t){return(mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bt(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function yt(t,e){return(yt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var o,r=xt(t);if(e){var i=xt(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return function(t,e){return!e||"object"!==mt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,o)}}function xt(t){return(xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}gt.datalist=[],gt.reservations=[];var St=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yt(t,e)}(s,n);var e,o,a=wt(s);function s(t){var e;return function(t,e){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}(this),(e=a.call(this,t)).baseColor=[.4,.4,.4],e.textColor=112/255,e.wh=0,e}return e=s,(o=[{key:"init",value:function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.gl=t;var r,a=[];this.imageRetrieves=[];var s=P.dotscale;return this.ratio=i.pixelRatio,i.isSP&&(this.ratio=2),this.node.find(".cube, .square").each(function(t,o){var c=$(o);r=c.is(".cube")?c.is(".board")?new Promise(function(t,r){var a=$(o).css("background-image").match(/\"(.*)\"/);if(a||(a=$(o).css("background-image").match(/\((.*)\)/)),a){var n=a[1],u=parseInt(c.attr("data-scale"));i.isSP&&(u=s*u/16);var l=parseInt(c.css("margin-top"))||0,h=c.is(".right")?"right":"";(new R).load(n).then(function(o){var r={view:"cube",type:"board",subtype:h,image:o,col:Math.ceil(c.width()/u),row:Math.ceil(o.height/u),dotscale:u,margintop:l,node:c,doodle:c.attr("data-doodle")};e.imageRetrieves.push({image:o,ret:r}),t(r)})}}):c.is(".ehead")?new Promise(function(t,r){var a=$(o).css("background-image").match(/\"(.*)\"/);if(a||(a=$(o).css("background-image").match(/\((.*)\)/)),a){var u=a[1],l=parseInt(c.attr("data-scale"));i.isSP&&(l=s*l/16);var h=parseInt(c.css("margin-top"))||0;(new R).load(u).then(function(o){var r={view:"cube",type:"ehead",subtype:"",image:o,col:Math.ceil(n.basew/l),row:1,gap:c.width()/l,placement:!i.isSP&&c.is(".left")?"left":"right",dotscale:l,margintop:h,node:c,doodle:c.attr("data-doodle")};e.imageRetrieves.push({image:o,ret:r}),t(r)})}}):c.is(".sectionhead")?new Promise(function(t,r){var a=$(o).css("background-image").match(/\"(.*)\"/);if(a||(a=$(o).css("background-image").match(/\((.*)\)/)),a){var n=a[1],u=parseInt(c.attr("data-scale"));i.isSP&&(u=s*u/16);var l=parseInt(c.css("margin-top"))||0;(new R).load(n).then(function(o){var r={view:"cube",type:"sectionhead",subtype:"",image:o,col:1,row:Math.ceil(o.height/u),dotscale:u,margintop:l,node:c};e.imageRetrieves.push({image:o,ret:r}),t(r)})}}):new Promise(function(t,e){var o=c.attr("data-src"),r=parseInt(c.attr("data-scale"));i.isSP&&(r=s*r/16);var a=parseInt(c.css("margin-top"))||0;(new R).load(o).then(function(e){var o=document.createElement("canvas");o.width=e.width,o.height=e.height;var i=o.getContext("2d");i.drawImage(e,0,0);var n={view:"cube",type:"texture",subtype:"",data:i.getImageData(0,0,e.width,e.height).data,col:e.width,row:e.height,dotscale:r,margintop:a,node:c};o.width=0,o.height=0,t(n)})}):c.is(".image")?new Promise(function(t,r){var a=$(o).css("background-image").match(/\"(.*)\"/);if(a||(a=$(o).css("background-image").match(/\((.*)\)/)),a){var n=a[1],u=parseInt(c.attr("data-scale"));i.isSP&&(u=s*u/16);var l=parseInt(c.css("margin-top"))||0;(new R).load(n).then(function(o){var r={view:"square",type:"image",subtype:"",image:o,col:o.width,row:o.height,dotscale:u,margintop:l,node:c};e.imageRetrieves.push({image:o,ret:r}),t(r)})}}):c.is(".listtop")?new Promise(function(t,e){var o=parseInt(c.css("margin-top"))||0,r=4;i.isSP&&(r=s*r/16),t({view:"square",type:"listtop",subtype:"",col:c.width(),row:1,dotscale:r,margintop:o,node:c})}):c.is(".dot")?new Promise(function(t,e){var o=parseInt(c.css("margin-top"))||0,r=c.is(".double")?"double":"",a=4;i.isSP&&(a=s*a/16),t({view:"square",type:"dot",subtype:r,col:1,row:1,dotscale:a,margintop:o,node:c})}):new Promise(function(t,e){var o=c.attr("data-src"),r=parseInt(c.attr("data-scale"));i.isSP&&(r=s*r/16);var a=parseInt(c.css("margin-top"))||0;(new R).load(o).then(function(e){var o=document.createElement("canvas");o.width=e.width,o.height=e.height;var i=o.getContext("2d");i.drawImage(e,0,0);var n={view:"square",type:"texture",subtype:"",data:i.getImageData(0,0,e.width,e.height).data,col:e.width,row:e.height,dotscale:r,margintop:a,node:c};o.width=0,o.height=0,t(n)})}),a.push(r)}),new Promise(function(t,r){Promise.all(a).then(function(r){e.setupTexture(),e.setupModel(r,o),e.setupScene(),t(e)})})}},{key:"setupTexture",value:function(){var t,e=this,o=0,r=0,i=0;this.imageRetrieves.forEach(function(t){o+t.image.height*e.ratio<4096?(o+=t.image.height*e.ratio,r<t.image.width*e.ratio&&(r=t.image.width*e.ratio)):(o=t.image.height*e.ratio,i+=r,r=t.image.width*e.ratio)}),t=i+r,this.textureOffsets=[];var a=document.createElement("canvas");a.width=t,a.height=4096;var n=0,s=0,c=0,u=a.getContext("2d");this.imageRetrieves.forEach(function(t){s+t.image.height*e.ratio<4096?(u.drawImage(t.image,c,s,t.image.width*e.ratio,t.image.height*e.ratio),e.textureOffsets.push([c,s]),s+=t.image.height*e.ratio,n<t.image.width*e.ratio&&(n=t.image.width*e.ratio)):(s=0,c+=n,n=0,u.drawImage(t.image,c,s,t.image.width*e.ratio,t.image.height*e.ratio),e.textureOffsets.push([c,s]),s+=t.image.height*e.ratio,n<t.image.width*e.ratio&&(n=t.image.width*e.ratio))}),this.texture=new l(this.gl),this.texture.generate(a,this.gl.CLAMP_TO_EDGE),this.textureSize=[a.width,a.height],a.width=0,a.height=0}},{key:"setupModel",value:function(t,e){var o,i,a,n=this,s=[];this.colors=[],this.matrices=[],this.invmatrices=[],this.colorVariables=[],this.colorWaits=[],this.colorVariablesSquare=[],this.colorWaitsSquare=[],this.colorGroup=[],this.matricesSquare=[],this.spreadsSquare=[],this.colorsSquare=[],this.colorsSquareBase=[],this.texoffsetsSquare=[],this.cubes=0,this.squares=0,this.cubeCount=0,this.cubeOffset=0,this.squareCount=0,this.squareOffset=0,this.cubeGroups=[],this.squareGroups=[],this.prohibitedPoints=[],this.hovColorIndicesList=[],this.hovColorIndices=[0,0],this.labelPartners=[],this.reservations=[],this.reservationsOriginal=[];var c=P.dotscale;t.forEach(function(t){o=new W(t.dotscale);var e,u=t.col,l=t.row,h=t.dotscale,f=h/c;s=[],t.margintop;var d=t.node.offset().left-n.node.offset().left,v=t.node.offset().top-n.node.offset().top;if("cube"==t.view){if(n.cubeGroups.push(o),"texture"==t.type){for(var p=t.data,g=0;g<l;g++){e=v/c+Math.floor(g*f),n.prohibitedPoints[e]||(n.prohibitedPoints[e]=[]);for(var m=d/c;m<d/c+u;m++)p[g*u*4+4*m+3]>0&&(s.push(m+.5,g+.5,-h/2),n.colors=n.colors.concat(n.baseColor),n.colorVariables.push(n.cubes),n.colorWaits.push(0),n.prohibitedPoints[e][Math.floor(m*f)]=!0,n.cubes++)}i=r.a.fromTranslation(r.a.create(),[d,v,h/2]),o.setBaseMatrix(i),a=s.length;for(var b=0;b<a;b+=3){var y=r.a.fromScaling(r.a.create(),[h,h,h]);r.a.translate(y,y,[s[b],s[b+1],0]),o.addChild(y)}}else if("ehead"==t.type){var w=n.generateTextureGroup(o,t,d,v,[0,0,0],!1);n.labelPartners.push(w),t.node.addClass("bghidable hidden"),o.setBaseMatrix(r.a.fromTranslation(r.a.create(),[0,v,h*l/2]));var x,S=t.gap;if(n.prohibitedPoints[v/c]||(n.prohibitedPoints[v/c]=[]),"right"==t.placement){x=r.a.fromScaling(r.a.create(),[h,h,h*l]),r.a.translate(x,x,[.5,.5,0]),o.addChild(x),n.colors=n.colors.concat(n.baseColor),n.colorVariables.push(n.cubes),n.colorWaits.push(0),n.cubes++,x=r.a.fromScaling(r.a.create(),[h,h,h*l]),r.a.translate(x,x,[1.5,.5,0]),o.addChild(x),n.colors=n.colors.concat(n.baseColor),n.colorVariables.push(n.cubes),n.colorWaits.push(0),n.cubes++,S-=2,x=r.a.fromScaling(r.a.create(),[h,h,h*l]),r.a.translate(x,x,[2+S+.5,.5,0]),o.addChild(x),n.colors=n.colors.concat(n.baseColor),n.colorVariables.push(n.cubes),n.colorWaits.push(0),n.cubes++,x=r.a.fromScaling(r.a.create(),[h*(u-3-S),h,h*l]),r.a.translate(x,x,[(3+S)/(u-3-S)+.5,.5,0]),o.addChild(x),n.colors=n.colors.concat(n.baseColor),n.cubes++;var C=n.prohibitedPoints[v/c];C[d]=!0,C[d+1]=!0;for(var M=2+S*f;M<u*f;M++)C[M]=!0}else{S+=u-parseInt(t.node.css("margin-left"))/h-S-2,x=r.a.fromScaling(r.a.create(),[h*(u-3-S),h,h*l]),r.a.translate(x,x,[.5,.5,0]),o.addChild(x),n.colors=n.colors.concat(n.baseColor),n.cubes++,x=r.a.fromScaling(r.a.create(),[h,h,h*l]),r.a.translate(x,x,[u-3-S+.5,.5,0]),o.addChild(x),n.colors=n.colors.concat(n.baseColor),n.colorVariables.push(n.cubes),n.colorWaits.push(0),n.cubes++,x=r.a.fromScaling(r.a.create(),[h,h,h*l]),r.a.translate(x,x,[u-2+.5,.5,0]),o.addChild(x),n.colors=n.colors.concat(n.baseColor),n.colorVariables.push(n.cubes),n.colorWaits.push(0),n.cubes++,x=r.a.fromScaling(r.a.create(),[h,h,h*l]),r.a.translate(x,x,[u-1+.5,.5,0]),o.addChild(x),n.colors=n.colors.concat(n.baseColor),n.colorVariables.push(n.cubes),n.colorWaits.push(0),n.cubes++;var O=n.prohibitedPoints[v/c];O[u-1]=!0,O[u-2]=!0;for(var E=0;E<(u-3-S)*f;E++)O[E]=!0}if(t.margintop,Math.floor(n.node.find(".en").outerHeight()/16),t.doodle){var P={name:t.doodle,position:[0,v,h],rotation:0};gt.reserve(P),n.reservations.push(P);var k={name:t.doodle,position:[0,v,h],rotation:0};n.reservationsOriginal.push(k)}}else if("sectionhead"==t.type){var T,R=n.generateTextureGroup(o,t,d,v,[0,0,0],!1);n.labelPartners.push(R),t.node.addClass("bghidable hidden"),o.setBaseMatrix(r.a.fromTranslation(r.a.create(),[d,v,h/2])),n.prohibitedPoints[Math.floor(v/c)]||(n.prohibitedPoints[Math.floor(v/c)]=[]),n.prohibitedPoints[Math.floor((v+1)/c)]||(n.prohibitedPoints[Math.floor((v+1)/c)]=[]),T=r.a.fromScaling(r.a.create(),[h,h,h]),r.a.translate(T,T,[.5,.5,0]),o.addChild(T),n.colors=n.colors.concat(n.baseColor),n.colorVariables.push(n.cubes),n.colorWaits.push(0),n.cubes++,T=r.a.fromScaling(r.a.create(),[h,h*(l-1),h]),r.a.translate(T,T,[.5,1/(l-1)+.5,0]),o.addChild(T),n.colors=n.colors.concat(n.baseColor),n.colorVariables.push(n.cubes),n.colorWaits.push(0),n.cubes++,n.prohibitedPoints[Math.floor(v/c)][0]=!0,n.prohibitedPoints[Math.floor((v+1)/c)][1]=!0}else if("board"==t.type){var A,q=n.generateTextureGroup(o,t,d,v,[0,h,0],!0);n.labelPartners.push(q),t.node.addClass("bghidable hidden"),o.setBaseMatrix(r.a.fromTranslation(r.a.create(),[d,v,0])),A=r.a.fromScaling(r.a.create(),[h*(u-1),h,h*l]),"right"==t.subtype?r.a.translate(A,A,[.5,.5,.5]):r.a.translate(A,A,[1/(u-1)+.5,.5,.5]),o.addChild(A),n.colors=n.colors.concat(n.baseColor),n.cubes++,A=r.a.fromScaling(r.a.create(),[h,h,h]),"right"==t.subtype?r.a.translate(A,A,[u-1+.5,.5,l-1+.5]):r.a.translate(A,A,[.5,.5,l-1+.5]),o.addChild(A),n.colors=n.colors.concat(n.baseColor),n.colorVariables.push(n.cubes),n.colorWaits.push(0),n.cubes++,A=r.a.fromScaling(r.a.create(),[h,h,h*(l-1)]),"right"==t.subtype?r.a.translate(A,A,[u-1+.5,.5,.5]):r.a.translate(A,A,[.5,.5,.5]),o.addChild(A),n.colors=n.colors.concat(n.baseColor),n.colorVariables.push(n.cubes),n.colorWaits.push(0),n.cubes++,n.prohibitedPoints[Math.floor(v/c)]||(n.prohibitedPoints[Math.floor(v/c)]=[]);for(var I=n.prohibitedPoints[Math.floor(v/c)],F=Math.floor(d/c);F<Math.floor(d/c)+Math.floor(u*f);F++)I[F]=!0;if(t.doodle){var B={name:t.doodle,position:[d,v,l*h],rotation:0};gt.reserve(B),n.reservations.push(B);var _={name:t.doodle,position:[d,v,l*h],rotation:0};n.reservationsOriginal.push(_)}}}else if("square"==t.view)if(n.squareGroups.push(o),"texture"==t.type){for(var L=t.data,D=n.squares,$=n.squares,G=0;G<l;G++)for(var j=0;j<u;j++){var N=G*u*4+4*j;if(L[N+3]>0){s.push(j+.5,G+.5,0);var z=Math.floor(v/c+G*f),U=Math.floor(d/c+j*f);n.colorGroup[z]||(n.colorGroup[z]=[]),n.colorGroup[z][U]||(n.colorGroup[z][U]=[]),n.colorGroup[z][U].push(n.squares),n.colorsSquare.push(L[N+0]/255,L[N+1]/255,L[N+2]/255),n.colorsSquareBase.push(L[N+0]/255,L[N+1]/255,L[N+2]/255),n.spreadsSquare.push(0,0),n.texoffsetsSquare.push(0,0),n.colorVariablesSquare.push(n.squares),n.colorWaitsSquare.push(0),$=n.squares,n.squares++}}t.node.is(".hov")&&n.hovColorIndicesList.push({node:t.node,indices:[D,$]}),i=r.a.fromTranslation(r.a.create(),[d,v,0]),o.setBaseMatrix(i),a=s.length;for(var Y=0;Y<a;Y+=3){var V=r.a.fromScaling(r.a.create(),[h,h,h]);r.a.translate(V,V,[s[Y],s[Y+1],0]),o.addChild(V)}}else if("image"==t.type){i=r.a.fromTranslation(r.a.create(),[d,v,0]),t.node.addClass("bghidable hidden"),o.setBaseMatrix(i),n.colorsSquare.push(0,0,0),n.colorsSquareBase.push(0,0,0),n.spreadsSquare.push(t.image.width*n.ratio,t.image.height*n.ratio);for(var X=n.imageRetrieves.length;X--;)if(n.imageRetrieves[X].ret==t){var H=n.textureOffsets[X];n.texoffsetsSquare.push(H[0],H[1]);break}n.colorVariablesSquare.push(n.squares),n.colorWaitsSquare.push(0),n.squares++;var Z=r.a.create();r.a.translate(Z,Z,[0,0,1]),Z=r.a.scale(Z,Z,[t.image.width,t.image.height,0]),r.a.translate(Z,Z,[.5,.5,.5]),o.addChild(Z)}else if("listtop"==t.type){i=r.a.fromTranslation(r.a.create(),[d,v,0]),o.setBaseMatrix(i),n.colorsSquare.push(77/255,77/255,77/255),n.colorsSquareBase.push(77/255,77/255,77/255),n.spreadsSquare.push(0,0),n.texoffsetsSquare.push(0,0),n.colorVariablesSquare.push(n.squares),n.colorWaitsSquare.push(0),n.squares++,n.colorsSquare.push(77/255,77/255,77/255),n.colorsSquareBase.push(77/255,77/255,77/255),n.spreadsSquare.push(0,0),n.texoffsetsSquare.push(0,0),n.colorVariablesSquare.push(n.squares),n.colorWaitsSquare.push(0),n.squares++;var J=r.a.create();J=r.a.scale(J,J,[t.dotscale,t.dotscale,0]),r.a.translate(J,J,[.5,.5,0]),o.addChild(J),J=r.a.create(),J=r.a.scale(J,J,[t.col,t.row,0]),r.a.translate(J,J,[.5,.5,0]),o.addChild(J)}else if("dot"==t.type){i=r.a.fromTranslation(r.a.create(),[d,v,0]),o.setBaseMatrix(i),n.colorsSquare.push(77/255,77/255,77/255),n.colorsSquareBase.push(77/255,77/255,77/255),n.spreadsSquare.push(0,0),n.texoffsetsSquare.push(0,0),n.colorVariablesSquare.push(n.squares),n.colorWaitsSquare.push(0),n.squares++,"double"==t.subtype&&(n.colorsSquare.push(77/255,77/255,77/255),n.colorsSquareBase.push(77/255,77/255,77/255),n.spreadsSquare.push(0,0),n.texoffsetsSquare.push(0,0),n.colorVariablesSquare.push(n.squares),n.colorWaitsSquare.push(0),n.squares++);var Q=r.a.create();Q=r.a.scale(Q,Q,[t.dotscale,t.dotscale,0]),r.a.translate(Q,Q,[.5,.5,0]),o.addChild(Q),"double"==t.subtype&&(Q=r.a.create(),Q=r.a.scale(Q,Q,[t.dotscale,t.dotscale,0]),r.a.translate(Q,Q,[2.5,.5,0]),o.addChild(Q))}o.height}),this.vboColors=new f(this.gl),this.vboMatrices=new f(this.gl),this.vboInvMatrices=new f(this.gl),this.vboColors.generate(new Float32Array(this.colors),this.gl.DYNAMIC_DRAW),this.matricesBase=new Float32Array(16*this.cubes),this.vboMatrices.generate(this.matricesBase,this.gl.DYNAMIC_DRAW),this.invmatricesBase=new Float32Array(16*this.cubes),this.vboInvMatrices.generate(this.invmatricesBase,this.gl.DYNAMIC_DRAW);for(var u=0;u<this.cubes;++u){var l=16*u*4;this.matrices.push(new Float32Array(this.matricesBase.buffer,l,16)),this.invmatrices.push(new Float32Array(this.invmatricesBase.buffer,l,16))}this.cubeCount=this.cubes;for(var h=0,d=function(t){var e=n.cubeGroups[t];e.matrices.forEach(function(t,o){r.a.multiply(n.matrices[o+h],e.matrix,t),r.a.invert(n.invmatrices[o+h],e.matrix)}),h+=e.matrices.length},v=0;v<this.cubeGroups.length;v++)d(v);this.vboMatrices.update(this.matricesBase),this.vboInvMatrices.update(this.invmatricesBase),this.vboMatricesSquare=new f(this.gl),this.vboSpreadsSquare=new f(this.gl),this.vboColorsSquare=new f(this.gl),this.vboTexoffsetsSquare=new f(this.gl),this.vboSpreadsSquare.generate(new Float32Array(this.spreadsSquare)),this.vboColorsSquare.generate(new Float32Array(this.colorsSquare)),this.vboTexoffsetsSquare.generate(new Float32Array(this.texoffsetsSquare)),this.matricesBaseSquare=new Float32Array(16*this.squares),this.vboMatricesSquare.generate(this.matricesBaseSquare,this.gl.DYNAMIC_DRAW);for(var p=0;p<this.squares;p++){var g=16*p*4;this.matricesSquare.push(new Float32Array(this.matricesBaseSquare.buffer,g,16))}this.squareCount=this.squares,h=0;for(var m=function(t){var e=n.squareGroups[t];e.matrices.forEach(function(t,o){r.a.multiply(n.matricesSquare[o+h],e.matrix,t)}),h+=e.matrices.length},b=0;b<this.squareGroups.length;b++)m(b);this.vboMatricesSquare.update(this.matricesBaseSquare),this.height=16*Math.ceil(this.node.height()/16),this.node.height(this.height)}},{key:"setupScene",value:function(){var t=this;this.node.find(".square.hov").each(function(e,o){$(o).on("hover",function(){for(var e=t.hovColorIndicesList.length;e--;)if(t.hovColorIndicesList[e].node[0]==o){t.hovColorIndices=t.hovColorIndicesList[e].indices;break}}).on("hoverend",function(){t.hovColorIndices=[0,0]})})}},{key:"generateTextureGroup",value:function(t,e,o,i,a){var n,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=new W(1);this.squareGroups.push(c),n=r.a.fromTranslation(r.a.create(),[o+a[0],i+a[1],a[2]]),c.setBaseMatrix(n),this.colorsSquare.push(0,0,0),this.colorsSquareBase.push(0,0,0),this.spreadsSquare.push(e.image.width*this.ratio,e.image.height*this.ratio);for(var u=this.imageRetrieves.length;u--;)if(this.imageRetrieves[u].ret==e){var l=this.textureOffsets[u];this.texoffsetsSquare.push(l[0],l[1]);break}this.colorVariablesSquare.push(this.squares),this.colorWaitsSquare.push(0),this.squares++;var h=r.a.create();return s?(r.a.translate(h,h,[0,1,0]),r.a.scale(h,h,[e.image.width,0,e.image.height]),r.a.translate(h,h,[.5,0,.5]),r.a.rotateX(h,h,-Math.PI/2)):(r.a.translate(h,h,[0,0,1]),h=r.a.scale(h,h,[e.image.width,e.image.height,0]),r.a.translate(h,h,[.5,.5,.5])),c.addChild(h),{cube:t,label:c,labelIndex:this.squares-1}}},{key:"update",value:function(){this.updateColor()}},{key:"updateColor",value:function(){var t=this;this.colorVariables.forEach(function(e,o){if(!(--t.colorWaits[o]>0)){var r=Math.floor(Math.random()*v.colors.length/3);t.colors[3*e+0]=v.colors[3*r+0],t.colors[3*e+1]=v.colors[3*r+1],t.colors[3*e+2]=v.colors[3*r+2],t.colorWaits[o]=20}}),this.vboColors.update(new Float32Array(this.colors));var e=this.hovColorIndices[0],o=this.hovColorIndices[1];this.colorVariablesSquare.forEach(function(r,i){if(!(--t.colorWaitsSquare[i]>0))if(e<=r&&r<o){if(Math.random()<.5){var a=Math.floor(Math.random()*v.colors.length/3);t.colorsSquare[3*r+0]=v.colors[3*a+0],t.colorsSquare[3*r+1]=v.colors[3*a+1],t.colorsSquare[3*r+2]=v.colors[3*a+2],t.colorWaitsSquare[i]=10}}else if(t.colorsSquare[3*r]==t.textColor){if(Math.random()<.001){var n=Math.floor(Math.random()*v.colors.length/3);t.colorsSquare[3*r+0]=v.colors[3*n+0],t.colorsSquare[3*r+1]=v.colors[3*n+1],t.colorsSquare[3*r+2]=v.colors[3*n+2],t.colorWaitsSquare[i]=50+100*Math.random()}}else t.colorsSquare[3*r+0]=t.colorsSquareBase[3*r+0],t.colorsSquare[3*r+1]=t.colorsSquareBase[3*r+1],t.colorsSquare[3*r+2]=t.colorsSquareBase[3*r+2],t.colorWaitsSquare[i]=50+80*Math.random()}),this.vboColorsSquare.update(new Float32Array(this.colorsSquare))}},{key:"setYOffset",value:function(t){for(var e=this,o=0,i=function(i){var a=e.cubeGroups[i],n=r.a.fromTranslation(r.a.create(),[0,t,0]);a.setOffsetMatrix(n),a.matrices.forEach(function(t,i){r.a.multiply(e.matrices[i+o],a.matrix,t)}),o+=a.matrices.length},a=0;a<this.cubeGroups.length;a++)i(a);this.vboMatrices.update(this.matricesBase),o=0;for(var n=function(i){var a=e.squareGroups[i],n=r.a.fromTranslation(r.a.create(),[0,t,0]);a.setOffsetMatrix(n),a.matrices.forEach(function(t,i){r.a.multiply(e.matricesSquare[i+o],a.matrix,t)}),o+=a.matrices.length},s=0;s<this.squareGroups.length;s++)n(s);this.vboMatricesSquare.update(this.matricesBaseSquare),this.reservations.forEach(function(o,r){o.position[1]=e.reservationsOriginal[r].position[1]+t})}},{key:"setNodeOffset",value:function(t){(i.isPC||this.wh<window.innerHeight)&&(this.wh=window.innerHeight),this.node.css("top",t+Math.floor((this.wh-n.baseh)/2))}},{key:"setSquareColor",value:function(t,e){var o=e[1],r=e[0];if(!this.colorGroup[o]||!this.colorGroup[o][r])return!1;for(var i=this.colorGroup[o][r].length;i--;){var a=this.colorGroup[o][r][i];this.colorsSquare[3*a+0]=t[0],this.colorsSquare[3*a+1]=t[1],this.colorsSquare[3*a+2]=t[2],this.colorWaitsSquare[a]=300}return!0}},{key:"checkMovablePoint",value:function(t,e){var o=t.length;for(e/=P.dotscale;o--;){var i=t[o].to,a=t[o].offsets,n=!1;if(0==a.w||0==a.h)this.prohibitedPoints[i[1]-e]&&this.prohibitedPoints[i[1]-e][i[0]]&&t.splice(o,1);else{for(var s=a.t-1;s<=a.b;s++){for(var c=a.l-1;c<=a.r;c++)if(this.prohibitedPoints[i[1]-e+s]&&this.prohibitedPoints[i[1]-e+s][i[0]+c]){t.splice(o,1),n=!0;break}if(n)break}if(!n){var u=t[o].data;if(r.b.length([u.dir[0],u.dir[1]])<1){var l=P.dotscale,h=i[1]-e+a.t-1,f=0+x.areaw;u.size>.5*l*H.scaleFactor&&0<=h&&h<this.height/l&&(i[0]+a.l>f||0>i[0]+a.r||t.splice(o,1))}}}}return t}}])&&bt(e.prototype,o),s}();function Ct(t){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mt(t,e){return(Mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ot(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var o,r=Et(t);if(e){var i=Et(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return function(t,e){return!e||"object"!==Ct(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,o)}}function Et(t){return(Et=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Pt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mt(t,e)}(o,St);var e=Ot(o);function o(t){return function(t,e){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}(this),e.call(this,t)}return o}();function kt(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}o(113),o(114);var Tt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e}var e,o,r;return e=t,r=[{key:"generate",value:function(e,o,r){var i=t.generateVertexShader(e,o),a=t.generateFragmentShader(e,r),n=e.createProgram();return e.attachShader(n,i),e.attachShader(n,a),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)?(e.useProgram(n),n):null}},{key:"generateVertexShader",value:function(t,e){var o=t.createShader(t.VERTEX_SHADER);return t.shaderSource(o,e),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)?o:null}},{key:"generateFragmentShader",value:function(t,e){var o=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(o,e),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)?o:null}}],(o=[{key:"generate",value:function(e,o){return this.program=t.generate(this.gl,e,o),this.setupProgram(),this.program}},{key:"setupProgram",value:function(){}},{key:"setupVBOIBO",value:function(t,e){this.vbos=t,this.ibo=e,this.apply()}},{key:"apply",value:function(){var t=this,e=this.gl;e.useProgram(this.program),this.applied?this.vbos.forEach(function(o,r){if(e.bindBuffer(e.ARRAY_BUFFER,o),16==t.attributeLength[r])for(var i=0;i<4;i++)e.vertexAttribPointer(t.attributeLocation[r]+i,4,e.FLOAT,!1,64,16*i);else e.vertexAttribPointer(t.attributeLocation[r],t.attributeLength[r],e.FLOAT,!1,0,0)}):(this.applied=!0,this.vbos.forEach(function(o,r){if(e.bindBuffer(e.ARRAY_BUFFER,o),16==t.attributeLength[r])for(var i=0;i<4;i++)e.enableVertexAttribArray(t.attributeLocation[r]+i),e.vertexAttribPointer(t.attributeLocation[r]+i,4,e.FLOAT,!1,64,16*i);else e.enableVertexAttribArray(t.attributeLocation[r]),e.vertexAttribPointer(t.attributeLocation[r],t.attributeLength[r],e.FLOAT,!1,0,0)})),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.ibo)}},{key:"setUniform",value:function(t){var e=this,o=this.gl;t.forEach(function(r,i){null!==r&&(-1===e.uniformFunction[i].indexOf("atrix")?o[e.uniformFunction[i]](e.uniformLocation[i],t[i]):o[e.uniformFunction[i]](e.uniformLocation[i],!1,t[i]))})}},{key:"setTexture",value:function(t){var e=this.gl;t.forEach(function(t,o){var r="TEXTURE"+o;e.activeTexture(e[r]),e.bindTexture(e.TEXTURE_2D,t)})}},{key:"draw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.gl.TRIANGLES;this.gl.drawElements(o,t,this.gl.UNSIGNED_SHORT,2*e)}},{key:"destroy",value:function(){this.gl.deleteProgram(this.program)}}])&&kt(e.prototype,o),r&&kt(e,r),t}();function Rt(t){return(Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function At(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function qt(t,e,o){return(qt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Bt(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(o):i.value}})(t,e,o||t)}function It(t,e){return(It=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ft(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var o,r=Bt(t);if(e){var i=Bt(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return function(t,e){return!e||"object"!==Rt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,o)}}function Bt(t){return(Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _t=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&It(t,e)}(i,Tt);var e,o,r=Ft(i);function i(t){return function(t,e){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this),r.call(this,t)}return e=i,(o=[{key:"generate",value:function(){return qt(Bt(i.prototype),"generate",this).call(this,"\n\t\tattribute vec3 vertex;\n\t\tattribute vec3 color;\n\t\tattribute mat4 matrix;\n\t\tattribute mat4 invMatrix;\n\t\tvarying vec3 vPosition;\n\t\tvarying vec3 vColor;\n\t\tvarying mat4 vInvMatrix;\n\t\tuniform mat4 vp;\n\t\t\n\t\tvoid main(){\n\t\t\tvPosition = (matrix * vec4(vertex.xyz,1.)).xyz;\n\t\t\tvColor = color;\n\t\t\tvInvMatrix = invMatrix;\n\n\t\t\tgl_Position = vp * matrix * vec4(vertex.xyz,1.);\n\t\t}\n\t\t","\n\t\t#extension GL_OES_standard_derivatives : enable\n\t\tprecision highp float;\n\t\tvarying vec3 vPosition;\n\t\tvarying vec3 vColor;\n\t\tvarying mat4 vInvMatrix;\n\t\tuniform vec3 lightDirection;\n\n\n\t\tvoid main(){\n\t\t\tvec3 nx = dFdx(vPosition);\n\t\t\tvec3 ny = dFdy(vPosition);\n\t\t\tvec3 n = normalize(cross(normalize(nx), normalize(ny)));\n\t\t\t//gl_FragColor = vec4(vColor * 0.5 + vColor * 0.5 * dot(n,normalize((vInvMatrix*vec4(vec3(2.,-10.,-4.),0.)).xyz)),1.);\n\t\t\t//gl_FragColor = vec4(vColor * 0.5 + vColor * 0.5 * dot(n,normalize((vInvMatrix*vec4(vec3(-1.,-2.,-10.),0.)).xyz)),1.);\n\t\t\tgl_FragColor = vec4(vColor * 0.5 + vColor * 0.5 * dot(n,normalize((vInvMatrix*vec4(lightDirection,0.)).xyz)),1.);\n\t\t}\n\t\t")}},{key:"setupProgram",value:function(){this.attributeLocation=[],this.attributeLocation[0]=this.gl.getAttribLocation(this.program,"vertex"),this.attributeLocation[1]=this.gl.getAttribLocation(this.program,"color"),this.attributeLocation[2]=this.gl.getAttribLocation(this.program,"matrix"),this.attributeLocation[3]=this.gl.getAttribLocation(this.program,"invMatrix"),this.ext=this.gl.getExtension("ANGLE_instanced_arrays"),this.attributeLength=[],this.attributeLength[0]=3,this.attributeLength[1]=3,this.attributeLength[2]=16,this.attributeLength[3]=16,this.uniformLocation=[],this.uniformLocation[0]=this.gl.getUniformLocation(this.program,"vp"),this.uniformLocation[1]=this.gl.getUniformLocation(this.program,"lightDirection"),this.uniformFunction=[],this.uniformFunction[0]="uniformMatrix4fv",this.uniformFunction[1]="uniform3fv"}},{key:"apply",value:function(){qt(Bt(i.prototype),"apply",this).call(this),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[0],0),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[1],1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[2],1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[2]+1,1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[2]+2,1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[2]+3,1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[3],1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[3]+1,1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[3]+2,1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[3]+3,1)}},{key:"drawInstance",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.ext.drawElementsInstancedANGLE(this.gl.TRIANGLES,t,this.gl.UNSIGNED_SHORT,2*o,e)}}])&&At(e.prototype,o),i}();function Lt(t){return(Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dt(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function $t(t,e,o){return($t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Nt(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(o):i.value}})(t,e,o||t)}function Gt(t,e){return(Gt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function jt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var o,r=Nt(t);if(e){var i=Nt(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return function(t,e){return!e||"object"!==Lt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,o)}}function Nt(t){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var zt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Gt(t,e)}(i,Tt);var e,o,r=jt(i);function i(t){return function(t,e){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this),r.call(this,t)}return e=i,(o=[{key:"generate",value:function(){return $t(Nt(i.prototype),"generate",this).call(this,"\n\t\tattribute vec3 vertex;\n\t\tattribute vec2 textureCoord;\n\t\tattribute mat4 matrix;\n\t\tattribute vec2 spread;\n\t\tattribute vec3 color;\n\t\tattribute vec2 texOffset;\n\t\tuniform mat4 vp;\n\t\tvarying vec2 vTextureCoord;\n\t\tvarying vec3 vColor;\n\t\t\n\t\tvoid main(){\n\t\t\tvTextureCoord = spread * textureCoord + texOffset;\n\t\t\tvColor = color;\n\t\t\tgl_Position = vp * matrix * vec4(vertex.xyz,1.);\n\n\n\t\t//\tvPosition = (matrix * vec4(vertex.xyz,1.)).xyz;\n\t\t//\tvColor = color;\n\t\t//\tvInvMatrix = invMatrix;\n\n\t\t}\n\t\t","\n\t\t#extension GL_OES_standard_derivatives : enable\n\t\tprecision highp float;\n\t\tuniform sampler2D texture;\n\t\tuniform vec2 textureSize;\n\t\tvarying vec2 vTextureCoord;\n\t\tvarying vec3 vColor;\n\n\n\t\tvoid main(){\n\t\t\tif(vColor.x>0.){\n\t\t\t\tgl_FragColor = vec4(vColor,1.);\n\t\t\t}else{\n\t\t\t\tgl_FragColor = vec4(texture2D(texture, vTextureCoord/textureSize).xyzw);\n\t\t\t}\n\t\t}\n\t\t")}},{key:"setupProgram",value:function(){this.attributeLocation=[],this.attributeLocation[0]=this.gl.getAttribLocation(this.program,"vertex"),this.attributeLocation[1]=this.gl.getAttribLocation(this.program,"textureCoord"),this.attributeLocation[2]=this.gl.getAttribLocation(this.program,"color"),this.attributeLocation[3]=this.gl.getAttribLocation(this.program,"matrix"),this.attributeLocation[4]=this.gl.getAttribLocation(this.program,"spread"),this.attributeLocation[5]=this.gl.getAttribLocation(this.program,"texOffset"),this.ext=this.gl.getExtension("ANGLE_instanced_arrays"),this.attributeLength=[],this.attributeLength[0]=3,this.attributeLength[1]=2,this.attributeLength[2]=3,this.attributeLength[3]=16,this.attributeLength[4]=2,this.attributeLength[5]=2,this.uniformLocation=[],this.uniformLocation[0]=this.gl.getUniformLocation(this.program,"vp"),this.uniformLocation[1]=this.gl.getUniformLocation(this.program,"texture"),this.uniformLocation[2]=this.gl.getUniformLocation(this.program,"textureSize"),this.uniformFunction=[],this.uniformFunction[0]="uniformMatrix4fv",this.uniformFunction[1]="uniform1i",this.uniformFunction[2]="uniform2fv"}},{key:"apply",value:function(){$t(Nt(i.prototype),"apply",this).call(this),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[0],0),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[1],0),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[2],1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[3],1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[3]+1,1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[3]+2,1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[3]+3,1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[4],1),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[5],1)}},{key:"drawInstance",value:function(t,e){this.ext.drawElementsInstancedANGLE(this.gl.TRIANGLES,t,this.gl.UNSIGNED_SHORT,0,e)}}])&&Dt(e.prototype,o),i}();function Ut(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Yt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o;return e=t,o=[{key:"init",value:function(t){var e=this;this.vertices=[],this.textureCoords=[],this.indices=[],this.vertices.push(-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0),this.textureCoords.push(0,0,1,0,0,1,1,1),this.indices.push(0,1,2,2,1,3),this.ibo=new c(t),this.vbo=new f(t),this.vboTextureCoords=new f(t),this.ibo.generate(new Int16Array(this.indices)),this.vbo.generate(new Float32Array(this.vertices)),this.vboTextureCoords.generate(new Float32Array(this.textureCoords)),this.indexLength=this.indices.length,this.matrix=r.a.create(),this.colors=[],ae.colorBases.forEach(function(t){e.colors.push(parseInt(t.substr(0,2),16)/255),e.colors.push(parseInt(t.substr(2,2),16)/255),e.colors.push(parseInt(t.substr(4,2),16)/255)}),this.dot=se.generate()}}],null&&Ut(e.prototype,null),o&&Ut(e,o),t}();function Vt(t){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wt(t,e){return(Wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Xt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var o,r=Ht(t);if(e){var i=Ht(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return function(t,e){return!e||"object"!==Vt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,o)}}function Ht(t){return(Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Zt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Wt(t,e)}(o,St);var e=Xt(o);function o(t){return function(t,e){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}(this),e.call(this,t)}return o}();function Jt(t){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qt(t,e){return(Qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Kt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var o,r=te(t);if(e){var i=te(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return function(t,e){return!e||"object"!==Jt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,o)}}function te(t){return(te=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ee=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qt(t,e)}(o,St);var e=Kt(o);function o(t){return function(t,e){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}(this),e.call(this,t)}return o}();function oe(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var re=function(){function t(e,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=e,this.body=o}var e,o;return e=t,(o=[{key:"render",value:function(t){this.container.style.perspective=t.focalLength+"px",this.body.style.transform="matrix3d("+t.vcss.join(",")+")"}}])&&oe(e.prototype,o),t}();function ie(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ae=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.mm=e,t.camera=e}var e,o;return e=t,(o=[{key:"init",value:function(){if(this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","view"),!(this.gl=this.initGL(this.canvas)))throw new Error;t.placement=$("html").is(".placement")}},{key:"initGL",value:function(t){var e=this.gl=t.getContext("webgl")||t.getContext("experimental-webgl");if(!e)throw new Error;if(!e.getExtension("OES_standard_derivatives"))throw new Error;if(!e.getExtension("ANGLE_instanced_arrays"))throw new Error;return e.clearColor(0,0,0,0),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e}},{key:"setupModel",value:function(){var e,o=this;$("#container").append($(this.canvas)),this.contents=[],this.contentBodies=[],this.contentStartingY=0;var r=this.gl;return this.cssRenderer=new re(document.getElementById("main"),null===(e=document.getElementById("main"))||void 0===e?void 0:e.querySelector(".container")),new Promise(function(e,a){v.init(r),Yt.init(r),P.init(),x.init(),o.intro=new st($("#top")),o.freeCubes=new P,o.doodles=new gt,gt.setInstance(o.doodles),o.statement=new Zt($("#statement")),o.legacy=new Pt($("#legacy")),o.philosophy=new ee($("#philosophy")),o.about=new Pt($("#about")),o.contents.push(o.intro);var s=[],c=$(window).width(),u=window.innerHeight;o.intro.resize(c*i.pixelRatio,u*i.pixelRatio),s.push(o.intro.init(r),o.statement.init(r),o.legacy.init(r),o.philosophy.init(r),o.about.init(r)),t.placement||s.push(o.doodles.init(o.gl)),Promise.all(s).then(function(i){t.placement||i.pop(),o.intro.setupScene(),o.programCube=new _t(r),o.programCube.generate(),o.programCube.setupVBOIBO([v.vbo.buffer,o.intro.vboColors.buffer,o.intro.vboMatrices.buffer,o.intro.vboInvMatrices.buffer],v.ibo.buffer),o.programCube.setUniform([null,t.lightDirection]),o.programSquare=new zt(r),o.programSquare.generate(),o.programSquare.setupVBOIBO([Yt.vbo.buffer,Yt.vboTextureCoords.buffer,o.intro.vboColorsSquare.buffer,o.intro.vboMatricesSquare.buffer,o.intro.vboSpreadsSquare.buffer,o.intro.vboTexoffsetsSquare.buffer],Yt.ibo.buffer),o.programSquare.setTexture([o.intro.texture.texture]),o.programSquare.setUniform([null,0,o.intro.textureSize]);var a=[],s=o.contentStartingY;i.forEach(function(t){t.setYOffset(s),s+=t.height+n.contentMargin,a.push(s)}),o.contentEndingY=s,o.doodles.updateReserved(),o.freeCubes.resize(c,u);for(var l=[],h=function(){var t=0;if(0==(l=o.freeCubes.initBefore(l,s/P.dotscale)).length)return"break";i.forEach(function(e){e.checkMovablePoint(l,t),t+=e.height+n.contentMargin})};"break"!==h(););o.freeCubes.init(o.gl),t.placement?window.parent.contentHeight(a[a.length-1]):o.doodles.prepare(a),e(o)}),$(o.intro).on("logoClicked",function(t){$(o).trigger("logoClicked")}).on("introMiddlePoint",function(e,r){$(o).trigger("introMiddlePoint"),t.placement&&window.parent.introMiddlePoint()}).on("introEnding",function(t){}),o.scrollOffsetBase=Math.floor(o.mm.getOffset()[1]/P.dotscale)*P.dotscale})}},{key:"startContent",value:function(){var e=this;t.placement&&window.parent.start();var o=[this.statement,this.legacy,this.philosophy,this.about];this.contentsDefault=o.slice(),this.contentsDefault.unshift(this.intro),requestAnimationFrame(function t(){var r=o.shift();e.contentBodies.push(r),e.contents.push(r),o.length?requestAnimationFrame(t):(e.starting=!0,e.doodles.start())});var r=P.dotscale;$(this.freeCubes).on("colorize",function(t,o){for(var i=o.position[1]-=e.contentStartingY/r,a=0;a<e.contents.length;a++){var s=e.contents[a];if(0<i&&i<s.height/r){o.position[1]=i,0<=o.position[0]&&o.position[0]<768/r&&s.setSquareColor(o.color,o.position);break}i=Math.floor(i-(s.height+n.contentMargin)/r)}})}},{key:"update",value:function(){var t;this.starting&&(this.freeCubes.update(),t=this.freeCubes.waitList,this.doodles.update());var e=this.contentStartingY;this.contents.forEach(function(o){o.update(),t&&o.checkMovablePoint(t,e),e+=o.height+n.contentMargin})}},{key:"clear",value:function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}},{key:"render",value:function(){var e=this,o=this.gl;if(o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),this.starting){var r=this.freeCubes;if(r.cubeCount&&(this.programCube.setupVBOIBO([v.vbo.buffer,r.vboColors.buffer,r.vboMatrices.buffer,r.vboInvMatrices.buffer],v.ibo.buffer),this.programCube.drawInstance(v.indexLength,r.cubeCount)),r.squareCount&&(this.programSquare.setupVBOIBO([Yt.vbo.buffer,Yt.vboTextureCoords.buffer,r.vboColorsSquare.buffer,r.vboMatricesSquare.buffer,r.vboSpreadsSquare.buffer,r.vboTexoffsetsSquare.buffer],Yt.ibo.buffer),this.programSquare.setUniform([null,null,[0,0]]),this.programSquare.drawInstance(Yt.indexLength,r.squareCount)),!t.placement)for((r=this.doodles).resetRendering();r.hasNext();)r.next(),this.programCube.setupVBOIBO([v.vbo.buffer,r.vboColors.buffer,r.vboMatrices.buffer,r.vboInvMatrices.buffer],v.ibo.buffer),this.programCube.drawInstance(v.indexLength,r.cubeCount)}this.contents.forEach(function(t){t.cubeCount&&(e.programCube.setupVBOIBO([v.vbo.buffer,t.vboColors.buffer,t.vboMatrices.buffer,t.vboInvMatrices.buffer],v.ibo.buffer),e.programCube.drawInstance(v.indexLength,t.cubeCount)),t.squareCount&&(e.programSquare.setupVBOIBO([Yt.vbo.buffer,Yt.vboTextureCoords.buffer,t.vboColorsSquare.buffer,t.vboMatricesSquare.buffer,t.vboSpreadsSquare.buffer,t.vboTexoffsetsSquare.buffer],Yt.ibo.buffer),e.programSquare.setUniform([null,null,t.textureSize]),e.programSquare.setTexture([t.texture.texture]),e.programSquare.drawInstance(Yt.indexLength,t.squareCount))}),this.cssRenderer.render(this.mm)}},{key:"resize",value:function(t,e){var o=i.pixelRatio,r=this.sw,a=this.sh;this.sw=t*o,this.sh=e*o,r==this.sw&&a==this.sh||this.resizeBody()}},{key:"resizeBody",value:function(){var t=this;if(this.gl){var e=i.pixelRatio;this.canvas.width=this.sw,this.canvas.height=this.sh,$(this.canvas).width(this.sw/e).height(this.sh/e),this.gl.viewport(0,0,this.sw,this.sh),this.updateMatrix(),this.starting&&this.freeCubes.resize(this.sw,this.sh),this.contents.forEach(function(e){e.resize(t.sw,t.sh)})}}},{key:"updateMatrix",value:function(){this.programCube.apply(),this.programCube.setUniform([this.mm.vp,t.lightDirection]),this.programSquare.apply(),this.programSquare.setUniform([this.mm.vp,null,null]);var e=this.mm.getOffset()[1];if(this.contentEndingY-e<x.H*P.dotscale){var o=this.contents.shift();this.contentStartingY+=o.height+n.contentMargin,this.contentEndingY+=o.height+n.contentMargin,this.contents.push(o);var r=this.contentStartingY;this.contents.forEach(function(t){t.setYOffset(r),t.setNodeOffset(r),r+=t.height+n.contentMargin}),this.doodles.updateReserved()}else if(this.contentStartingY>0&&this.contentStartingY-e>-x.H*P.dotscale){var i=this.contents.pop();this.contentStartingY-=i.height+n.contentMargin,this.contentEndingY-=i.height+n.contentMargin,this.contents.unshift(i);var a=this.contentStartingY;this.contents.forEach(function(t){t.setYOffset(a),t.setNodeOffset(a),a+=t.height+n.contentMargin}),this.doodles.updateReserved()}else{var s=this.contentStartingY;this.contents.forEach(function(t){t.setNodeOffset(s),s+=t.height+n.contentMargin})}}},{key:"getContentTop",value:function(t){for(var e=0,o=0,r=this.contentsDefault.length,i=0;i<r;i++)i==t&&(e=o),o+=this.contentsDefault[i].height+n.contentMargin;return{height:o,target:e}}},{key:"toggleMode",value:function(t){if(this.contents.forEach(function(e){e.toggleMode(t)}),!t){this.contents=this.contentsDefault.slice(),this.contentStartingY=0;var e=this.contentStartingY;this.contents.forEach(function(t){t.setYOffset(e),e+=t.height+n.contentMargin}),this.contentEndingY=e,this.doodles.updateReserved()}}},{key:"getCurrentContent",value:function(t){t%=this.height();for(var e=0,o=this.contentsDefault.length,r=0;r<o;r++)if(t<(e+=this.contentsDefault[r].height+n.contentMargin))return r;return 0}},{key:"height",value:function(){for(var t=0,e=this.contentsDefault.length,o=0;o<e;o++)t+=this.contentsDefault[o].height+n.contentMargin;return t}}])&&ie(e.prototype,o),t}();function ne(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}ae.colorBases=["4398cd","d82d17","47a639","edcb1f"],ae.lightDirectionIntro=[-1,-2,-10],ae.lightDirectionDefault=[1,-10,-3],ae.lightDirection=[ae.lightDirectionIntro[0],ae.lightDirectionIntro[1],ae.lightDirectionIntro[2]],ae.scrollTop=0;var se=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o;return e=t,o=[{key:"generate",value:function(){if(!this.canvas)if(this.canvas=document.createElement("canvas"),ae.placement){this.canvas.width=this.canvas.height=32;var t=this.canvas.getContext("2d");t.fillStyle="#000000",t.fillRect(0,0,32,32),t.fillStyle="#0c0c0c",t.fillRect(0,0,32,16),t.fillRect(0,16,16,16),t.fillStyle="#181818",t.fillRect(0,0,16,16),t.fillStyle="#000000",t.fillRect(0,0,32,32),t.fillStyle="#0c0c0c",t.fillRect(0,0,32,16),t.fillStyle="#181818",t.fillRect(0,0,1,32)}else{this.canvas.width=this.canvas.height=8;var e=this.canvas.getContext("2d");e.fillStyle="#000000",e.fillRect(0,0,8,8),e.fillStyle="#121212",e.fillRect(0,0,4,4)}return this.canvas}}],null&&ne(e.prototype,null),o&&ne(e,o),t}();function ce(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ue=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o;return e=t,o=[{key:"generate",value:function(t,e,o,i){return r.a.perspective(r.a.create(),2*Math.atan(o/(2*t)),e/o,t-i,t+i)}}],null&&ce(e.prototype,null),o&&ce(e,o),t}();function le(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var he=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.mat=r.a.create(),this.pos=[0,0,0],this.deg=[0,0,0]}var e,o;return e=t,(o=[{key:"lookAtOrigin",value:function(t,e){var o=Math.PI/180,i=[0,0,t],a=[0,1,0];r.c.rotateX(i,i,[0,0,0],e[0]*o),r.c.rotateY(i,i,[0,0,0],e[1]*o),r.c.rotateZ(i,i,[0,0,0],e[2]*o),r.c.rotateX(a,a,[0,0,0],e[0]*o),r.c.rotateY(a,a,[0,0,0],e[1]*o),r.c.rotateZ(a,a,[0,0,0],e[2]*o),this.pos=i,this.deg=[e[0],e[1],e[2]];var n=r.a.create();r.a.lookAt(n,i,[0,0,0],a),r.a.scale(this.mat,n,[1,-1,1])}},{key:"setMatrix",value:function(t){r.a.scale(this.mat,t,[1,-1,1])}}])&&le(e.prototype,o),t}();function fe(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var de=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.v=r.a.create(),this.p=r.a.create(),this.vp=r.a.create(),this.vcss=r.a.create(),this.mvp=r.a.create(),this.focalLength=0}var e,o;return e=t,(o=[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];this.prepareCSS=e,this.focalLength=t.introFocal,this.distanceFromOrigin=this.focalLength,this.rots=[0,0,0],this.offsetX=this.offsetXBase=o[0],this.offsetY=this.offsetYBase=o[1],this.offsetZ=this.offsetZBase=o[2],this.stageOffsetX=this.stageOffsetY=0,this.sw=this.sh=0,this.posture=new he}},{key:"resize",value:function(t,e){var o=i.pixelRatio;this.sw=t,this.sh=e,this.stageOffsetX=t/o%2/2,this.stageOffsetY=e/o%2/2}},{key:"updateVP",value:function(){this.posture.lookAtOrigin(this.distanceFromOrigin,this.rots);var t=r.a.clone(this.posture.mat),e=-this.stageOffsetX-this.offsetX,o=-this.stageOffsetY-this.offsetY,i=-this.offsetZ;r.a.translate(this.v,t,[e,o,i]),this.p=ue.generate(this.focalLength,this.sw,this.sh,.9*this.focalLength),r.a.multiply(this.vp,this.p,this.v),this.prepareCSS&&(t[1]*=-1,t[5]*=-1,t[7]*=-1,t[9]*=-1,e+=this.offsetXBase,o+=this.offsetYBase,r.a.translate(t,t,[e,o,i]),r.a.fromTranslation(this.vcss,[0,0,this.focalLength]),r.a.multiply(this.vcss,this.vcss,t))}},{key:"getOffset",value:function(){return[this.offsetX,this.offsetY,this.offsetZ]}},{key:"setDistanceFromOrigin",value:function(t){this.distanceFromOrigin=t}},{key:"setOffset",value:function(t,e,o){this.offsetX=t,this.offsetY=e,this.offsetZ=o}},{key:"setRotation",value:function(t){this.rots=t}},{key:"setFocalLength",value:function(t){this.focalLength=t}},{key:"getMVP",value:function(t){return r.a.multiply(this.mvp,this.vp,t),this.mvp}}])&&fe(e.prototype,o),t}();function ve(t){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pe(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ge(t,e,o){return(ge="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ye(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(o):i.value}})(t,e,o||t)}function me(t,e){return(me=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function be(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var o,r=ye(t);if(e){var i=ye(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return function(t,e){return!e||"object"!==ve(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,o)}}function ye(t){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}de.introFocal=200,de.viewFocal=5e3,de.viewXRot=45,de.m=r.a.create();var we=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&me(t,e)}(i,Tt);var e,o,r=be(i);function i(t){return function(t,e){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this),r.call(this,t)}return e=i,(o=[{key:"generate",value:function(){return ge(ye(i.prototype),"generate",this).call(this,"\n\t\tattribute vec3 vertex;\n\t\tattribute vec2 textureCoord;\n\t\tuniform mat4 mvp;\n\t\tuniform float st;\n\t\tvarying vec2 vTextureCoord;\n\t\t\n\t\tvoid main(){\n\t\t//\tgl_Position = vec4(position.xyz, 1);\n\t\t\tgl_Position = mvp * vec4(vec3(vertex.x,vertex.y+st,vertex.z), 1);\n\t\t\tvTextureCoord = textureCoord;\n\t\t}\n\n\t\t","\n\t\tprecision highp float;\n\t\tuniform vec2 resolution;\n\t\tuniform sampler2D dot;\n\t\tuniform float w;\n\t\tuniform float st;\n\t\tvarying vec2 vTextureCoord;\n\n\t\tvoid main(){\n\t\t\tvec2 p = vTextureCoord * resolution;\n\t\t\t//gl_FragColor = vec4(texture2D(dot, (p+st)/w).xyzw);\n\t\t\tgl_FragColor = texture2D(dot, vec2(p.x,p.y+st)/w);\n\t\t}\n\t\t")}},{key:"setupProgram",value:function(){this.ext=this.gl.getExtension("ANGLE_instanced_arrays"),this.attributeLocation=[],this.attributeLocation[0]=this.gl.getAttribLocation(this.program,"vertex"),this.attributeLocation[1]=this.gl.getAttribLocation(this.program,"textureCoord"),this.attributeLength=[],this.attributeLength[0]=3,this.attributeLength[1]=2,this.uniformLocation=[],this.uniformLocation[0]=this.gl.getUniformLocation(this.program,"resolution"),this.uniformLocation[1]=this.gl.getUniformLocation(this.program,"dot"),this.uniformLocation[2]=this.gl.getUniformLocation(this.program,"mvp"),this.uniformLocation[3]=this.gl.getUniformLocation(this.program,"w"),this.uniformLocation[4]=this.gl.getUniformLocation(this.program,"st"),this.uniformFunction=[],this.uniformFunction[0]="uniform2fv",this.uniformFunction[1]="uniform1i",this.uniformFunction[2]="uniformMatrix4fv",this.uniformFunction[3]="uniform1f",this.uniformFunction[4]="uniform1f"}},{key:"apply",value:function(){ge(ye(i.prototype),"apply",this).call(this),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[0],0),this.ext.vertexAttribDivisorANGLE(this.attributeLocation[1],0)}}])&&pe(e.prototype,o),i}();function xe(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Se=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o;return e=t,(o=[{key:"init",value:function(){this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","dot"),(this.gl=this.initGL(this.canvas))&&$("#container").append($(this.canvas))}},{key:"initGL",value:function(t){var e=this.gl=t.getContext("webgl")||t.getContext("experimental-webgl");if(!e)throw new Error;return e.clearColor(0,0,0,0),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e}},{key:"setupModel",value:function(){var t=this.gl;this.iboDot=new c(t),this.vboDotVertices=new f(t),this.vboDotTextureCoords=new f(t),this.iboDot.generate(new Int16Array([0,1,2,2,1,3])),this.vboDotVertices.generate(new Float32Array([0,0,0,3*this.sw,0,0,0,3*this.sh,0,3*this.sw,3*this.sh,0])),this.vboDotTextureCoords.generate(new Float32Array([0,0,3,0,0,3,3,3]));var e=se.generate();this.dotTexture=new l(t),this.dotTexture.generate(e,t.REPEAT),this.programDot=new we(t),this.programDot.generate(),this.programDot.setupVBOIBO([this.vboDotVertices.buffer,this.vboDotTextureCoords.buffer],this.iboDot.buffer),this.programDot.setTexture([this.dotTexture.texture]),this.programDot.setUniform([[this.sw,this.sh],0,null,ae.placement?32:8])}},{key:"render",value:function(){var t=this.gl;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.programDot.draw(6,0)}},{key:"resize",value:function(t,e){var o=i.pixelRatio,r=this.sw,a=this.sh;this.sw=t*o,this.sh=e*o,r==this.sw&&a==this.sh||this.resizeBody()}},{key:"resizeBody",value:function(){if(this.gl){var t=i.pixelRatio;this.canvas.width=this.sw,this.canvas.height=this.sh,$(this.canvas).width(this.sw/t).height(this.sh/t),this.gl.viewport(0,0,this.sw,this.sh);var e=n.basew,o=n.baseh,r=1*e+Math.ceil(this.sw/(1*e))*e*1*2,a=1*o+Math.ceil(1+this.sh/(1*o))*o*1*2;this.vboDotVertices.update(new Float32Array([0,0,0,r,0,0,0,a,0,r,a,0])),this.vboDotTextureCoords.update(new Float32Array([0,0,r/e,0,0,a/o,r/e,a/o])),this.updateMatrix()}}},{key:"updateMatrix",value:function(){var t=n.basew,e=n.baseh,o=i.isSP?2:1,a=Math.ceil(this.sw/(1*t))*t*1,s=Math.ceil(1+this.sh/(1*e))*e*1,c=r.a.create();r.a.translate(c,de.m,[-a,-s,0]),this.programDot.setUniform([[t*o,e*o],null,ae.camera.getMVP(c),null,ae.scrollTop])}},{key:"startScroll",value:function(){this.scrolling=!0}}])&&xe(e.prototype,o),t}();function Ce(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}o(188);var Me=function(){var t,e;function o(){!function(t,e){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}(this)}return t=o,e=[{key:"isLandscape",value:function(){var t=screen&&screen.orientation&&screen.orientation.angle;return void 0===t&&(t=window.orientation),0!=t}}],null&&Ce(t.prototype,null),e&&Ce(t,e),o}(),Oe=function(t,e,o){window.gtag("event",e,{event_label:o,event_category:t,non_interaction:!0})};function Ee(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Pe=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o;return e=t,(o=[{key:"load",value:function(t){var e=this;return new Promise(function(o,r){var i=[];t.each(function(t,e){var o=$(e);if(o.css("background-image")&&"none"!=o.css("background-image")){var r=o.css("background-image").match(/\"(.*)\"/);r||(r=o.css("background-image").match(/\((.*)\)/));var a=r[1];i.push($.ajax({url:a,dataType:"text"}).done(function(t){var e=$(t);e.attr("id",e.attr("id")+A(4)),o.removeClass("hideText").css({"background-image":"none"}).empty(),o.append(e)}))}}),$.when(i).then(function(){o(e)})})}}])&&Ee(e.prototype,o),t}();$(document).on("ready",function(){var t,e,o=function(){var e;t=!0,document.documentElement.classList.add("lite"),$("#top").height(window.innerHeight),$("#navi").addClass("show active").find("h1, ul.main li").on("click",function(t){var e,o=$(t.currentTarget).attr("data-id");$("#navi").find(".close").trigger("touchend"),e="top"==o?0:$("section#"+$(t.currentTarget).attr("data-id")).offset().top-(i.isSP?44:64),_(e)}),$("#navi .view").remove(),$("#toggleMenu").addClass("show").on("click",function(t){e=$(window).scrollTop(),$("#navi").addClass("drawn"),$("#toggleMenu").removeClass("show"),$("html").addClass("modal"),$("#main .container").on("touchstart",function(t){o()}),$(window).scrollTop(0),$("#container").scrollTop(e)});var o=function(){$("#navi").removeClass("drawn"),$("#toggleMenu").addClass("show"),$("html").removeClass("modal"),$("#main .container").off("touchstart"),$("#container").scrollTop(0),$(window).scrollTop(e)};L($("#navi").find(".close"),function(){o()})};if($("html").is(".lite"))return Oe("view mode","lite view","decisive"),void o();n.init(),e=new de;var a,s,c=new ae(e);try{c.init()}catch(t){return Oe("environment","no gl",""),Oe("view mode","lite view","auto"),void o()}if(i.isIE)return Oe("view mode","lite view","ie"),void o();Oe("view mode","default view","auto"),e.init(!0,[n.basew/2,n.baseh/2,0]);var u,l=0,h=e.offsetXBase,f=e.offsetYBase,d=e.offsetZBase,v=!0;i.isSP||(i.pixelRatio=i.pixelRatio>1?2:1);var p=new Se;c.setupModel().then(function(){var o,n;p.init(),p.setupModel(),s=window.innerHeight,i.isSP&&$("#top").height(window.innerHeight),$(window).on("resize",function(t){$("html").is(".lite")||(a=$(window).width(),i.isSP||i.isTAB?s<window.innerHeight&&(s=window.innerHeight,$("#top").height(window.innerHeight),$("#container").height(s),$("#main").height(s)):s=window.innerHeight,l=i.isSP?90*Math.atan2(3*a,s)/Math.PI:90*Math.atan2(2*a,s)/Math.PI,o&&e.setRotation([de.viewXRot,0,l]),e.setOffset(h,f,d),e.resize(a,s),e.updateVP(),c.resize(a,s),p.resize(a,s),p.render())}),$(window).trigger("resize"),$(c).on("introMiddlePoint",function(t){var i,a,n=performance.now(),s=new b(.5,0,.5,1),u=!1,g=de.introFocal,w=de.viewFocal,x=de.viewXRot,S=function t(){if(!o){var d=performance.now()-n;d>2400?(i=1,u=!0):(!a&&d>1680&&(a=!0,n-=960,d+=960,i=s.get(d/2400),requestAnimationFrame(C),$("#navi").addClass("show"),$("#toggleMenu").addClass("show"),c.startContent()),i=s.get(d/2400),a&&(n+=720)),e.setDistanceFromOrigin(g*(1-i)+.3*w*i),e.setRotation([x*i,-10*i,l*i]),e.setFocalLength(g*(1-i)+w*i),r.c.lerp(ae.lightDirection,ae.lightDirectionIntro,ae.lightDirectionDefault,i),h=e.offsetXBase*(1-i)+(e.offsetXBase+20)*i,f=e.offsetYBase*(1-i)+(e.offsetYBase+80)*i,e.updateVP(),c.updateMatrix(),p.updateMatrix(),a||requestAnimationFrame(t)}},C=function t(){if(!o){var a=performance.now()-n;a>2400?(i=1,u=!0):i=s.get(a/2400),e.setDistanceFromOrigin(g*(1-i)+w*i),e.setRotation([x,0,l]),e.setFocalLength(5*g*(1-i)+w*i),h=e.offsetXBase*(1-i)+(e.offsetXBase+20)*i,f=e.offsetYBase*(1-i)+(e.offsetYBase+80)*i,r.c.lerp(ae.lightDirection,ae.lightDirectionIntro,ae.lightDirectionDefault,i),e.setOffset(h,f,d),e.updateVP(),c.updateMatrix(),p.updateMatrix(),u?(o=!0,v=!1,y(),m()):requestAnimationFrame(t)}};requestAnimationFrame(S),S()});var g=!1,m=function(){u=f,$("#dummy").height(c.height()),$(window).on("scroll",function(){if(!g&&!$("html").is(".modal"))if(t){var o=$("#main").find(".container > section").length-1,r=$(window).height();if($("#main").find(".container > section").each(function(t,e){if($(e).offset().top>=$(window).scrollTop()+r/2)return o=t-1,!1}),o>0){var i=$("#navi").find("ul.main li:eq("+(o-1)+")");i.is(".current")||($("#navi").find("ul.main li").removeClass("current"),i.addClass("current"))}else $("#navi").find("ul.main li").removeClass("current")}else{var a=c.getCurrentContent($(window).scrollTop());if(a>0){var n=$("#navi").find("ul.main li:eq("+(a-1)+")");n.is(".current")||($("#navi").find("ul.main li").removeClass("current"),n.addClass("current"))}else $("#navi").find("ul.main li").removeClass("current")}if(!$("html").is(".lite, .modal")){ae.scrollTop=$(window).scrollTop(),ae.placement&&c.starting&&window.parent.scroll(ae.scrollTop);var s=ae.scrollTop+u;s>f?c.freeCubes.changeDirs(1):s<f&&c.freeCubes.changeDirs(-1),f=s,e.setOffset(h,f,d),e.updateVP(),c.updateMatrix(),!ae.placement&&$("#dummy").height()-f<2e3&&$("#dummy").height($("#dummy").height()+c.height())}}),$(window).scrollTop(0),p.startScroll()},y=function(){$("#navi").addClass("active"),(new Pe).load($("#navi").find(".cssbgsvg")),$("#navi").find("h1, ul.main li").on("click",function(e){i.isSP&&$("#navi").find(".close").trigger("touchend"),g=!0,$("#navi").find("h1, ul.main li").removeClass("current"),$(e.currentTarget).addClass("current");var o=-1;if(t){var a;a="top"==$(e.currentTarget).attr("data-id")?0:$("section#"+$(e.currentTarget).attr("data-id")).offset().top-(i.isSP?44:64),$(document).off("mousedown touchstart wheel keydown").on("mousedown touchstart wheel keydown",function(){n=!0,g=!1,$(document).off("slided"),$(document).off("mousedown touchstart wheel keydown")}),_(a),$(document).off("slided").on("slided",function(){n=!0,g=!1,$(document).off("slided"),$(document).off("mousedown touchstart wheel keydown")})}else{$("#navi").find("h1, ul.main li").each(function(t,r){if(r==e.currentTarget)return o=t,!1});var s=c.getContentTop(o),l=s.height,h=s.target+Math.floor((f-u)/l)*l;h<f-u&&(h+=l),h!=f-u&&($(document).off("mousedown touchstart wheel keydown").on("mousedown touchstart wheel keydown",function(){$(window).scrollTop(f-u),ae.scrollTop=f-u,n=!0,g=!1,$(document).off("mousedown touchstart wheel keydown")}),r(h)),K.click()}}).on("hover",function(){t||K.over()}),$("#navi").find("footer ul li a").on("click",function(e){t||K.click()}).on("hover",function(){t||K.over()});var o,r=function(t){var e,o=0,r=0,i=ae.scrollTop;requestAnimationFrame(function a(){if(n)return n=!1,S=!0,g=!1,void $(document).off("mousedown touchstart wheel keydown");o<.1*(t-i)?o+=r+=.15:o=.1*(t-i),t-(i+=o)<.4&&(i=t,e=!0),$(window).scrollTop(i),e?(n=!1,S=!0,g=!1,$(document).off("mousedown touchstart wheel keydown")):requestAnimationFrame(a)})};L($("#navi").find(".view .button"),function(){var o;if(t=!t,i.isSP&&$("#navi").find(".close").trigger("touchend"),Oe("view mode",t?"lite view":"default view","selective"),c.toggleMode(t),t){$("html").toggleClass("lite"),c.clear(),$("#top").height(window.innerHeight),$("#view, #dot").addClass("hidden");var r=c.getCurrentContent((f-u)%c.height()+300);o=0==r?0:$($("#top, #main .container > section")[r]).offset().top-(i.isSP?44:64),$(window).scrollTop(o-300),_(o,$(document),!1),K.mutebgm()}else{$("#view, #dot").removeClass("hidden");var a=$(window).scrollTop(),n=0,l=-1;$("#top, #main .container > section").each(function(t,e){if(n+=$(e).height(),a<n-s/2)return l=t,!1;n+=parseInt($(e).css("margin-top"))}),-1==l&&(l=$("#top, #main .container > section").length-1),$("#top").height(s),$("html").toggleClass("lite");var v=c.getContentTop(l);o=v.target+u,$(window).scrollTop(v.target),ae.scrollTop=v.target,f=o,e.setOffset(h,f,d),e.updateVP(),c.updateMatrix(),c.doodles.resetIndex(),requestAnimationFrame(C),K.click(),K.bgm()}}),$("#navi").find(".view .button").on("hover",function(){t||K.over()}),$("#navi").find(".toggleSound").on("click",function(){K.muted?(K.muted=!1,K.click(),K.bgm(),$("#navi").find(".toggleSound").removeClass("muted")):(K.muted=!0,K.mutebgm(),$("#navi").find(".toggleSound").addClass("muted"))}).on("hover",function(){K.muted||K.over()}),$("#toggleMenu").on("click",function(){o=$(window).scrollTop(),$("#navi").addClass("drawn"),$("#toggleMenu").removeClass("show"),$("html").addClass("modal"),$("#main, #main .container").on("touchstart",function(t){$("#navi").find(".close").trigger("touchend")}),f=o+u,$(window).scrollTop(0),$("#container").scrollTop(o),t||K.click()}),L($("#navi").find(".close"),function(){$("#navi").removeClass("drawn"),$("#toggleMenu").addClass("show"),$("html").removeClass("modal"),$("#main, #main .container").off("touchstart"),$("#container").scrollTop(0),t?$(window).scrollTop(o):($(window).scrollTop(f-u),ae.scrollTop=f-u,e.setOffset(h,f,d),e.updateVP(),c.updateMatrix())})},w=0,x=Math.floor(1e3/59),S=!0,C=function e(o){t||(o-w<x||(w=o,S&&(c.updateMatrix(),c.update(),c.render(),(v||ae.placement)&&(p.updateMatrix(),p.render()))),requestAnimationFrame(e))};requestAnimationFrame(C),c.update(),c.render()}),$("body").on("mousedown.initSound touchstart.initSound",function(){$("body").off("mousedown.initSound touchstart.initSound"),K.init()})}),function(){i.setup();var t=document.documentElement.className;!function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(o){var r=document.getElementsByTagName("meta"),i=Array.prototype.find.apply(r,[function(t){return"viewport"===t.getAttribute("name")}]);if(i){var a,n;Me.isLandscape()?(n=Math.max(window.outerWidth,window.outerHeight),a=1280):(n=Math.min(window.outerWidth,window.outerHeight),a=840),i.setAttribute("content","width="+a+",initial-scale="+n/a+",minimum-scale="+n/a+",maximum-scale="+n/a);window.addEventListener("orientationchange",function r(i){if(document.getElementsByTagName("body")[0].classList.contains("noOrientationReload"))return window.removeEventListener("orientationchange",r),void t(e,o);document.getElementsByTagName("html")[0].classList.add("orientationchange"),document.getElementsByTagName("body")[0].setAttribute("style","display:none"),location.reload()})}}else if(e){if(window.innerWidth<375){var s=document.getElementsByTagName("meta"),c=Array.prototype.find.apply(s,[function(t){return"viewport"===t.getAttribute("name")}]);if(c){var u,l=375;u=Me.isLandscape()?Math.max(window.outerWidth,window.outerHeight):Math.min(window.outerWidth,window.outerHeight),c.setAttribute("content","width=375,initial-scale="+u/l+",minimum-scale="+u/l+",maximum-scale="+u/l)}}window.addEventListener("orientationchange",function r(i){if(document.getElementsByTagName("body")[0].classList.contains("noOrientationReload"))return window.removeEventListener("orientationchange",r),void t(e,o);document.getElementsByTagName("html")[0].classList.add("orientationchange"),document.getElementsByTagName("body")[0].setAttribute("style","display:none"),location.reload()})}}(t.indexOf("sp")>-1,t.indexOf("tablet")>-1),location.search.indexOf("lite")>-1&&document.documentElement.classList.add("lite"),self!=window.parent&&document.documentElement.classList.add("placement"),$(function(){et.init(),$("#container").removeClass("init"),$(".hov").each(function(t,e){var o=$(e);o.on("hover",function(t){o.addClass("hover")}).on("hoverend",function(t){o.removeClass("hover")}).on("touchstart.hoverable",function(t){o.trigger("hover"),o.off("touchmove.hoverable touchend.hoverable"),o.on("touchmove.hoverable",function(t){i.isMobile&&(o.off("touchmove.hoverable touchend.hoverable"),o.trigger("hoverend"))}).on("touchend.hoverable",function(t){o.off("touchmove.hoverable touchend.hoverable"),o.trigger("hoverend")})}).on("mouseenter.hoverable",function(t){i.isMobile||o.trigger("hover")}).on("mouseleave.hoverable",function(t){i.isMobile||o.trigger("hoverend")})}),$(document).trigger("ready")})}()}});